<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRAMATIQU√äS - Pr√°tica de Gram√°tica Portuguesa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Slab:wght@700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f0f0; /* Cinza claro s√≥lido */
        }
        .title-font {
            font-family: 'Roboto Slab', serif;
        }
        /* Nova classe para a fonte "Modo Concurseiro" */
        .concurseiro-font {
            font-family: 'Pacifico', cursive; /* Usando Pacifico como alternativa a Bodega Script */
        }
        .option-btn {
            transition: all 0.2s ease-in-out;
            /* Novos estilos para os bot√µes de op√ß√£o */
            background-color: #e0f7fa; /* light-blue-50 */
            border-color: #81d4fa; /* light-blue-200 */
            color: #006064; /* deep-teal-800 */
        }
        .option-btn:hover {
            background-color: #b2ebf2; /* light-blue-100 */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .correct {
            background-color: #22c55e !important; /* green-500 */
            color: white !important;
            border-color: #16a34a; /* green-600 */
            transform: scale(1.02);
        }
        .incorrect {
            background-color: #ef4444 !important; /* red-500 */
            color: white !important;
            border-color: #dc2626; /* red-600 */
        }
        .disabled {
            pointer-events: none;
            opacity: 0.9;
        }
        .topic-card {
            page-break-inside: avoid;
            break-inside: avoid;
            /* Novos estilos para os cart√µes de t√≥pico */
            border-left: 8px solid #0ea5e9; /* sky-500 */
            transition: all 0.2s ease-in-out;
        }
        .topic-card:hover {
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-3px);
        }
        .topic-list-grid { /* Alterado de #topic-list para .topic-list-grid */
            column-count: 1;
        }
        @media (min-width: 768px) {
            .topic-list-grid { /* Alterado de #topic-list para .topic-list-grid */
                column-count: 2;
            }
        }
        /* Estilos para o Modal */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-container {
            transition: all 0.3s ease;
            /* Ajustes para o tamanho e rolagem dos modais */
            max-height: 90vh; /* Limita a altura m√°xima para caber na tela */
            overflow-y: auto; /* Adiciona rolagem vertical se o conte√∫do exceder a altura */
        }
        /* Estilos para o spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3b82f6; /* blue-500 */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Estilo para o popup de informa√ß√µes */
        .info-popup {
            position: absolute;
            bottom: 1.5rem; /* Ajustado para descer mais */
            right: 0.5rem; /* Mantido no canto direito */
            background-color: #fff;
            padding: 0.6rem 0.8rem; /* Reduzido em aproximadamente 20% */
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-size: 0.7rem; /* Reduzido em aproximadamente 20% */
            color: #475569; /* slate-600 */
            z-index: 50; /* Garante que fique acima de outros elementos */
        }
        /* Ajuste para a tela inicial para permitir posicionamento absoluto do popup */
        #home-screen {
            position: relative; /* Necess√°rio para posicionar o popup absolutamente dentro dela */
            overflow: hidden; /* Para garantir que o fundo de texto n√£o vaze */
        }
        /* Estilo para o fundo de texto transparente */
        .text-background-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Permite cliques nos elementos abaixo */
            z-index: 1; /* Garante que fique atr√°s do conte√∫do principal */
            color: rgba(100, 100, 100, 0.08); /* Cinza muito claro com mais transpar√™ncia */
            font-size: 1.8rem; /* Ligeiramente maior */
            line-height: 1.8;
            text-align: center;
            overflow: hidden;
            word-break: break-all;
            white-space: pre-wrap; /* Preserva espa√ßos em branco e quebras de linha */
            user-select: none; /* Impede sele√ß√£o de texto */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.05); /* Sombra sutil para efeito 3D */
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 100px,
                rgba(220, 220, 220, 0.03) 100px, /* Ajuste para mais transpar√™ncia no gradiente tamb√©m */
                rgba(220, 220, 220, 0.03) 200px
            );
        }
        /* Estilo para o √≠cone do professor no modal */
        .professor-icon {
            display: inline-block;
            vertical-align: middle;
            margin-right: 0.5rem;
            color: #4f46e5; /* indigo-600 */
        }
        /* Estilo para o √≠cone de ajuda */
        .help-icon {
            display: inline-block;
            vertical-align: middle;
            margin-right: 0.5rem;
            color: #fff; /* white */
        }
        /* Estilo para o iframe do YouTube */
        .video-responsive {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            max-width: 100%;
            background: #000;
            border-radius: 0.5rem;
        }
        .video-responsive iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }
        .difficulty-label.selected,
        .response-mode-label.selected { /* Adicionado para o modo de resposta */
            background-color: #3b82f6; /* blue-500 */
            color: white;
            border-color: #3b82f6;
        }

        /* Estilos para a Tela Final */
        #final-screen {
            background: linear-gradient(to bottom right, #e0f2fe, #bbdefb); /* Gradiente azul claro */
            border-radius: 1.5rem; /* Cantos mais arredondados */
            padding: 3rem; /* Mais padding */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15); /* Sombra mais pronunciada */
            animation: fadeInScale 0.5s ease-out forwards;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        #final-screen h2 {
            color: #1e40af; /* Azul mais escuro */
            font-size: 3.5rem; /* T√≠tulo maior */
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        #final-screen #final-topic {
            color: #1d4ed8; /* Azul m√©dio */
            font-size: 1.75rem;
            margin-bottom: 1.5rem;
        }

        #final-screen .text-lg.text-slate-600 {
            color: #475569; /* Cinza slate */
            font-weight: 500;
        }

        #final-screen #final-score {
            color: #059669; /* Verde esmeralda */
            font-size: 7rem; /* Pontua√ß√£o gigante */
            font-weight: 800;
            margin-bottom: 2rem;
            text-shadow: 3px 33px 6px rgba(0, 0, 0, 0.2);
        }

        #final-screen #final-time {
            color: #64748b; /* Cinza mais escuro */
            font-size: 1.25rem;
            margin-bottom: 2.5rem;
        }

        #final-screen .flex button {
            padding: 1rem 2rem;
            border-radius: 9999px; /* Bot√µes completamente arredondados */
            font-size: 1.1rem;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #final-screen #restart-quiz {
            background-color: #2563eb; /* Azul vibrante */
            color: white;
            border: 2px solid #1d4ed8;
        }
        #final-screen #restart-quiz:hover {
            background-color: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
        }

        #final-screen #back-to-menu-final,
        #final-screen #back-to-home-from-final {
            background-color: #cbd5e1; /* Cinza mais claro */
            color: #334155;
            border: 2px solid #94a3b8;
        }
        #final-screen #back-to-menu-final:hover,
        #final-screen #back-to-home-from-final:hover {
            background-color: #94a3b8;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
        }

        /* Novo estilo para o modal de texto */
        .text-modal-content {
            background-color: #fff; /* Fundo branco */
            border: 1px solid #e0e0e0; /* Borda sutil */
            border-radius: 8px;
            padding: 1.5rem;
            line-height: 1.6;
            font-size: 1rem;
            color: #333; /* Cor do texto mais escura */
            max-height: 70vh; /* Altura m√°xima para rolagem */
            overflow-y: auto; /* Habilita a rolagem vertical */
            box-shadow: inset 0 0 5px rgba(0,0,0,0.05); /* Sombra interna sutil */
            position: relative;
            background-image: linear-gradient(to bottom, #f9f9f9 1px, transparent 1px); /* Linhas de caderno */
            background-size: 100% 1.8em; /* Altura da linha */
        }
        .text-modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 40px; /* Margem esquerda para a linha vertical */
            bottom: 0;
            width: 1px;
            background-color: rgba(255, 0, 0, 0.2); /* Linha vertical vermelha clara */
        }
        /* Estilo para o conte√∫do do modal de estudo */
        #study-text {
            color: #333; /* Cor do texto mais escura para o conte√∫do de estudo */
        }

        /* Estilos para o modal de autentica√ß√£o */
        .auth-tab-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem 0.5rem 0 0;
            font-weight: 600;
            color: #64748b; /* slate-500 */
            background-color: #e2e8f0; /* slate-200 */
            transition: all 0.2s ease-in-out;
            border-bottom: 2px solid transparent;
        }
        .auth-tab-button.active {
            color: #3b82f6; /* blue-500 */
            background-color: #fff;
            border-bottom: 2px solid #3b82f6;
        }
        .auth-tab-content {
            padding: 1.5rem;
            background-color: #fff;
            border-radius: 0 0 0.5rem 0.5rem;
        }
        /* Estilo para a descri√ß√£o do diagrama */
        .diagram-description {
            background-color: #f0f9ff; /* light-blue-50 */
            border-left: 4px solid #0ea5e9; /* sky-500 */
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 0.5rem;
            font-style: italic;
            color: #0c4a6e; /* sky-900 */
            font-size: 0.95rem;
        }
        /* Estilo para o Canvas */
        #diagram-canvas {
            width: 100%; /* Faz o canvas ocupar a largura total do seu cont√™iner */
            max-width: 400px; /* Limita a largura m√°xima para n√£o ficar muito grande em desktops */
            height: 300px; /* Altura fixa para o canvas */
            display: block; /* Remove espa√ßo extra abaixo do canvas */
            margin: 0 auto 1.5rem auto; /* Centraliza e adiciona margem inferior */
            background-color: #ffffff; /* Fundo branco para o canvas */
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); /* Sombra sutil */
        }

        /* Estilos para o pop-up de corre√ß√£o em tempo real */
        .correction-popup {
            position: absolute;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 0.5rem;
            padding: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 100;
            font-size: 0.875rem;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        .correction-popup button {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .correction-popup button:hover {
            background-color: #2563eb; /* blue-600 */
        }
        .correction-popup .suggestion {
            font-weight: 600;
            color: #1e40af; /* blue-800 */
        }

        /* Estilos para as textareas de reda√ß√£o */
        .essay-section-textarea {
            min-height: 80px; /* Altura m√≠nima padr√£o */
            line-height: 1.5; /* Espa√ßamento entre linhas */
        }

        /* Estilo para o bot√£o de ajuda */
        .help-button-icon {
            color: #6b7280; /* slate-500 */
            cursor: pointer;
            transition: color 0.2s;
        }
        .help-button-icon:hover {
            color: #4f46e5; /* indigo-600 */
        }
        .help-button-icon.disabled {
            pointer-events: none;
            opacity: 0.5;
        }

        /* Novas classes para estiliza√ß√£o de texto no modal de estudo */
        .highlight-term {
            color: #dc2626; /* red-600 */
            font-weight: bold;
        }
        .underline-text {
            text-decoration: underline;
            text-decoration-color: #2563eb; /* blue-600 */
            text-decoration-thickness: 2px;
        }
        .important-phrase {
            color: #047857; /* emerald-700 */
            background-color: #d1fae5; /* green-100 */
            padding: 2px 4px;
            border-radius: 4px;
        }

        /* Ajuste para bot√µes de estudo */
        .study-button {
            display: flex;
            align-items: center;
            padding: 0.3rem 0.6rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
        }
        .study-button {
            background-color: #e0f2fe; /* blue-50 */
            color: #2563eb; /* blue-600 */
            border: 1px solid #93c5fd; /* blue-300 */
        }
        .study-button:hover {
            background-color: #bfdbfe; /* blue-100 */
        }
        .study-button svg {
            margin-right: 0.25rem;
        }

    </style>
</head>
<body class="bg-slate-100 text-slate-800 flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-3xl mx-auto">
        
        <!-- Tela Inicial (Home Screen) -->
        <div id="home-screen" class="text-center">
            <!-- Fundo de texto transparente -->
            <div class="text-background-overlay">
                Gram√°tica Morfologia Sintaxe Fon√©tica Fonologia Acentua√ß√£o Ortografia H√≠fen Fonemas Encontros Voc√°licos Substantivo Adjetivo Verbo Artigo Pronome Adv√©rbio Preposi√ß√£o Conjun√ß√£o Numeral Interjei√ß√£o Morfema Termos Essenciais Sujeito Predicado Termos Integrantes Objeto Direto Objeto Indireto Complemento Nominal Agente da Passiva Termos Acess√≥rios Adjunto Adnominal Adjunto Adverbial Aposto Vocativo Concord√¢ncia Verbal Concord√¢ncia Nominal Reg√™ncia Verbal Reg√™ncia Nominal Transitividade Verbal Vozes do Verbo Voz Ativa Voz Passiva Voz Reflexiva Uso da V√≠rgula Crase Ora√ß√µes Reduzidas Coloca√ß√£o Pronominal Fun√ß√µes do Que e Se Pontua√ß√£o Portugu√™s L√≠ngua Portuguesa Estudo Pr√°tica Aprender Conhecimento
            </div>

            <header class="mb-10 relative z-10">
                <h1 class="text-5xl md:text-6xl font-bold text-slate-700 title-font">GRAMATIQU√äS</h1>
                <!-- Novo elemento para "Modo Concurseiro" com contorno -->
                <div class="inline-block border-2 border-indigo-600 rounded-lg px-4 py-2 mt-2 bg-white shadow-md">
                    <p class="text-indigo-700 text-2xl concurseiro-font">Modo Concurseiro</p>
                </div>
                <p class="text-slate-500 mt-2 text-lg">Aprenda e pratique para a sua aprova√ß√£o!</p>
            </header>
            <main class="flex justify-center items-center h-64 relative z-10">
                <!-- √çcone SVG com corte lateral no primeiro c√≠rculo -->
                <svg class="w-48 h-48 text-sky-600 drop-shadow-lg" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <!-- C√≠rculo externo com corte lateral -->
                    <path d="M 18 4 A 10 10 0 1 0 18 20" stroke="currentColor" stroke-width="2" fill="none"/>
                    <!-- C√≠rculo interno -->
                    <circle cx="12" cy="12" r="5" fill="currentColor"/>
                </svg>
            </main>
            <div id="level-selection-section" class="mt-8 relative z-10">
                <h3 class="text-2xl font-bold text-slate-700 mb-4">Selecione a op√ß√£o:</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6 max-w-2xl mx-auto">
                    <!-- Bot√µes para as diferentes mat√©rias -->
                    <button id="level-enem" class="level-select-btn bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg" data-level="enem">
                        L√≠ngua Portuguesa
                    </button>
                    <button id="level-pedagogicos" class="level-select-btn bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg" data-level="pedagogicos">
                        Conhecimentos Pedag√≥gicos
                    </button>
                    <button id="level-redacao" class="level-select-btn bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg" data-level="redacao">
                        Reda√ß√£o - Conte√∫do
                    </button>
                    <button id="level-redacao-correcao" class="level-select-btn bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg" data-level="redacao-correcao">
                        Reda√ß√£o - Corre√ß√£o de Texto
                    </button>
                    <button id="level-bonus" class="level-select-btn bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg" data-level="bonus">
                        Direito
                    </button>
                    <button id="level-leis" class="level-select-btn bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg" data-level="leis">
                        Leis e Diretrizes da Educa√ß√£o
                    </button>
                    <!-- Novo bot√£o para No√ß√µes de Inform√°tica -->
                    <button id="level-informatica" class="level-select-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg" data-level="informatica">
                        No√ß√µes de Inform√°tica
                    </button>
                </div>
                <button id="enter-app-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition-colors shadow-lg opacity-50 cursor-not-allowed" disabled>
                    Iniciar
                </button>
            </div>
            <footer class="mt-8 relative z-10 text-xs text-slate-500">
                <p>Desenvolvido por: Prof.¬∫ Marlon Costa - L√≠ngua Portuguesa e Literatura / Gramatiqu√™s Vers√£o 1.0</p>
            </footer>
        </div>

        <!-- Tela de Sele√ß√£o de T√≥pico (para n√≠veis n√£o-concurseiro) - Ser√° escondida permanentemente -->
        <div id="topic-selection-screen" class="hidden">
            <header class="text-center mb-10">
                <h1 class="text-5xl md:text-6xl font-bold text-slate-700 title-font">GRAMATIQU√äS</h1>
                <p class="text-slate-500 mt-2 text-lg">Selecione um ou mais t√≥picos para estudar ou praticar.</p>
            </header>
            <main id="topic-container-quiz" class="space-y-8">
                <!-- Categorias e T√≥picos ser√£o inseridos aqui -->
            </main>
            <footer class="mt-8 text-center flex flex-col sm:flex-row justify-center items-center gap-4">
                <div class="flex items-center gap-2">
                    <label for="question-quantity-quiz" class="text-slate-700 font-semibold">Quest√µes:</label>
                    <input type="number" id="question-quantity-quiz" value="10" min="1" class="w-20 p-2 border border-slate-300 rounded-lg text-center">
                </div>
                <button id="start-selected-quiz" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-8 rounded-lg transition-colors shadow-lg opacity-50 cursor-not-allowed" disabled>
                    Iniciar Quiz com T√≥picos Selecionados
                </button>
                <button id="back-to-home-from-topics" class="back-to-home bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-3 px-6 rounded-lg transition-colors">
                    Voltar para o In√≠cio
                </button>
            </footer>
        </div>

        <!-- Tela de Configura√ß√£o do Simulado (para n√≠vel Concurseiro) -->
        <div id="simulado-setup-screen" class="hidden">
            <header class="text-center mb-10">
                <h1 class="text-5xl md:text-6xl font-bold text-slate-700 title-font">SIMULADO GRAMATIQU√äS</h1>
                <p class="text-slate-500 mt-2 text-lg">Selecione os t√≥picos e configure seu simulado.</p>
            </header>
            <div class="mb-6 max-w-2xl mx-auto">
                <label for="topic-search-input" class="block text-lg font-semibold text-slate-700 mb-2">
                    Pesquisar T√≥pico:
                </label>
                <input type="text" id="topic-search-input" class="w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 text-slate-700" placeholder="Digite para pesquisar t√≥picos...">
            </div>
            <main id="topic-container-simulado" class="space-y-8">
                <!-- As novas categorias de t√≥picos ser√£o inseridas aqui -->
            </main>
            <div class="mt-8 text-center flex flex-col items-center gap-4">
                <!-- Bot√µes de configura√ß√£o -->
                <div class="flex flex-wrap justify-center gap-4 w-full max-w-lg mx-auto">
                    <div class="flex flex-col items-center">
                        <button id="btn-num-questions" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg">
                            N¬∫ de Quest√µes
                        </button>
                        <p id="display-num-questions" class="text-black font-bold text-sm mt-1">---</p>
                    </div>
                    <div class="flex flex-col items-center">
                        <button id="btn-difficulty" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg">
                            N√≠vel
                        </button>
                        <p id="display-difficulty" class="text-black font-bold text-sm mt-1">---</p>
                    </div>
                    <div class="flex flex-col items-center">
                        <button id="btn-response-mode" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg">
                            Tipo de Gabarito
                        </button>
                        <p id="display-response-mode" class="text-black font-bold text-sm mt-1">---</p>
                    </div>
                </div>
                
                <button id="start-simulado" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg transition-colors shadow-lg opacity-50 cursor-not-allowed mt-6">
                    Gerar Simulado
                </button>
                <button id="back-to-home-from-simulado-setup" class="back-to-home bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-3 px-6 rounded-lg transition-colors">
                    Voltar para o In√≠cio
                </button>
            </div>
        </div>

        <!-- Tela de Leis e Diretrizes -->
        <div id="laws-screen" class="hidden">
            <header class="text-center mb-10">
                <h1 class="text-5xl md:text-6xl font-bold text-slate-700 title-font">LEIS E DIRETRIZES</h1>
                <p class="text-slate-500 mt-2 text-lg">Consulte os principais documentos da educa√ß√£o brasileira.</p>
            </header>
            <main id="laws-list-container" class="space-y-4 max-w-2xl mx-auto">
                <!-- Lista de leis ser√° inserida aqui -->
            </main>
            <footer class="mt-8 text-center">
                <button id="back-to-home-from-laws" class="back-to-home bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-3 px-6 rounded-lg transition-colors">
                    Voltar para o In√≠cio
                </button>
            </footer>
        </div>

        <!-- Tela do Quiz -->
        <div id="quiz-screen" class="hidden">
            <header class="mb-8 p-4 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl shadow-md max-w-2xl mx-auto">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h2 id="quiz-topic-title" class="text-2xl font-bold text-sky-700"></h2>
                        <p id="question-counter" class="text-slate-500"></p>
                    </div>
                    <div class="text-right">
                        <p class="text-slate-500">Pontua√ß√£o</p>
                        <p id="score" class="text-2xl font-bold text-slate-700">0</p>
                    </div>
                </div>
                <!-- Timer para Simulado -->
                <div id="timer-display-container" class="text-center text-lg font-semibold text-slate-700 mb-4 hidden">
                    Tempo: <span id="timer-display">00:00</span>
                </div>
                <!-- Barra de Progresso -->
                <div class="w-full bg-blue-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-sky-500 h-2.5 rounded-full transition-all duration-300 ease-out" style="width: 0%;"></div>
                </div>
            </header>

            <main id="question-container" class="bg-gradient-to-br from-blue-100 to-blue-200 p-6 md:p-8 rounded-xl shadow-md max-w-2xl mx-auto">
                <div id="loading-area" class="flex flex-col justify-center items-center h-40 hidden">
                    <div class="spinner mb-2"></div>
                    <p id="loading-text" class="text-slate-600 font-semibold">Gerando Quest√µes...</p>
                </div>
                <div id="quiz-content">
                    <p id="question-text" class="text-lg md:text-xl mb-6 min-h-[60px]"></p>
                    <!-- Bot√£o "+ Texto" -->
                    <button id="show-text-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-lg mb-4 hidden">
                        + Texto
                    </button>
                    <div id="options-container" class="flex flex-col space-y-3">
                        <!-- Op√ß√µes ser√£o inseridas aqui -->
                    </div>
                </div>
            </main>

            <footer class="mt-6 flex flex-wrap justify-center items-center gap-4 max-w-2xl mx-auto">
                <button id="back-to-menu" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-2 px-4 rounded-lg transition-colors">
                    Menu
                </button>
                <!-- Bot√£o "Perguntar ao Gramatiquinho" (vis√≠vel apenas para quizzes normais) -->
                <button id="ask-friends-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-lg flex items-center">
                    <span class="help-icon">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                    </span> Perguntar ao Gramatiquinho (<span id="friends-help-count">3</span>)
                </button>
                <!-- Bot√£o "Recurso da Quest√£o" -->
                <button id="appeal-question-btn" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-lg flex items-center hidden">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                    </svg>
                    Recurso da Quest√£o
                </button>
                <button id="next-question" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg hidden">
                    Pr√≥xima Pergunta &rarr;
                </button>
            </footer>
        </div>

        <!-- Tela Final -->
        <div id="final-screen" class="hidden text-center bg-white p-8 rounded-xl shadow-md max-w-2xl mx-auto">
            <h2 class="text-3xl font-bold text-slate-700 mb-2">Quiz Finalizado!</h2>
            <p id="final-topic" class="text-xl text-sky-700 font-semibold mb-4"></p>
            <p class="text-lg text-slate-600 mb-1">Sua pontua√ß√£o final foi:</p>
            <p id="final-score" class="text-6xl font-bold text-slate-800 mb-4"></p>
            <p id="final-time" class="text-lg text-slate-600 mb-8 hidden"></p> <!-- Tempo final do simulado -->
            <div class="flex flex-wrap justify-center gap-4">
                <button id="restart-quiz" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                    Tentar Novamente
                </button>
                <button id="back-to-menu-final" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-3 px-6 rounded-lg transition-colors">
                    Escolher outro T√≥pico
                </button>
                <button id="back-to-home-from-final" class="back-to-home bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-3 px-6 rounded-lg transition-colors">
                    Voltar √† Tela Inicial
                </button>
            </div>
        </div>

        <!-- Tela de Corre√ß√£o de Reda√ß√£o -->
        <div id="essay-correction-screen" class="hidden">
            <header class="text-center mb-10">
                <h1 class="text-5xl md:text-6xl font-bold text-slate-700 title-font">PR√ÅTICA DE REDA√á√ÉO</h1>
                <p class="text-slate-500 mt-2 text-lg">Pratique a estrutura da sua reda√ß√£o e receba feedback.</p>
            </header>
            <main class="bg-white p-6 md:p-8 rounded-xl shadow-md max-w-2xl mx-auto relative">
                <div id="theme-display" class="bg-blue-50 p-3 rounded-lg border border-blue-200 text-blue-800 font-semibold mb-4 hidden">
                    <p class="text-sm text-blue-600">Tema da Reda√ß√£o:</p>
                    <p id="generated-theme-text" class="text-lg"></p>
                </div>
                
                <!-- Bot√£o Gerar Tema (movido para cima) -->
                <div class="flex flex-wrap justify-center gap-4 mb-6">
                    <button id="generate-theme-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg">
                        Gerar Tema de Reda√ß√£o
                    </button>
                </div>

                <!-- Campo de T√≠tulo Opcional -->
                <div class="mb-6">
                    <label for="essay-title-input" class="block text-lg font-semibold text-slate-700 mb-2">
                        T√≠tulo (Opcional):
                    </label>
                    <input type="text" id="essay-title-input" class="w-full p-4 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-700" placeholder="Digite o t√≠tulo da sua reda√ß√£o aqui...">
                </div>

                <div class="mb-6">
                    <label for="intro-input" class="block text-lg font-semibold text-slate-700 mb-2">
                        Introdu√ß√£o:
                        <button type="button" class="help-button-icon align-middle" data-section="introducao" title="Dicas de Introdu√ß√£o">
                            <span class="text-xl">ü§ù</span> Ajuda
                        </button>
                    </label>
                    <textarea id="intro-input" class="essay-section-textarea w-full p-4 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 resize-y text-slate-700" placeholder="Comece sua introdu√ß√£o aqui..."></textarea>
                </div>
                <div class="mb-6">
                    <label for="dev-input" class="block text-lg font-semibold text-slate-700 mb-2">
                        Desenvolvimento:
                        <button type="button" class="help-button-icon align-middle" data-section="desenvolvimento" title="Dicas de Desenvolvimento">
                            <span class="text-xl">ü§ù</span> Ajuda
                        </button>
                    </label>
                    <textarea id="dev-input" class="essay-section-textarea w-full p-4 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 resize-y text-slate-700" placeholder="Desenvolva seus argumentos aqui..."></textarea>
                </div>
                <div class="mb-6">
                    <label for="conc-input" class="block text-lg font-semibold text-slate-700 mb-2">
                        Conclus√£o:
                        <button type="button" class="help-button-icon align-middle" data-section="conclusao" title="Dicas de Conclus√£o">
                            <span class="text-xl">ü§ù</span> Ajuda
                        </button>
                    </label>
                    <textarea id="conc-input" class="essay-section-textarea w-full p-4 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 resize-y text-slate-700" placeholder="Conclua sua reda√ß√£o aqui..."></textarea>
                </div>
                
                <div id="correction-loading-area" class="flex flex-col justify-center items-center h-20 hidden">
                    <div class="spinner mb-2"></div>
                    <p class="text-slate-600 font-semibold">Analisando sua reda√ß√£o...</p>
                </div>
                
                <!-- Bot√£o Corrigir Reda√ß√£o (movido para aqui) -->
                <div class="flex justify-center mb-6">
                    <button id="correct-essay-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-lg transition-colors shadow-lg">
                        Corrigir Reda√ß√£o
                    </button>
                </div>

                <div id="essay-feedback" class="bg-slate-50 p-4 rounded-lg border border-slate-200 min-h-[100px] text-slate-700 prose max-w-none">
                    <p class="text-slate-500 italic">Seu feedback aparecer√° aqui.</p>
                </div>

                <!-- Bot√µes de refazer reda√ß√£o e download PDF -->
                <div id="post-correction-actions" class="flex flex-wrap justify-center gap-4 mt-6 hidden">
                    <button id="redo-same-theme-btn" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-lg">
                        Refazer com o mesmo tema
                    </button>
                    <button id="redo-new-theme-btn" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-lg">
                        Gerar novo tema e refazer
                    </button>
                    <button id="download-essay-pdf-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-lg">
                        Download PDF
                    </button>
                </div>
                
                <div id="pdf-loading-area" class="flex flex-col justify-center items-center h-20 hidden">
                    <div class="spinner mb-2"></div>
                    <p class="text-slate-600 font-semibold">Gerando PDF...</p>
                </div>

                <!-- Container para popups de corre√ß√£o em tempo real -->
                <div id="realtime-correction-popups"></div>
            </main>
            <footer class="mt-8 text-center">
                <button id="back-to-home-from-essay-correction" class="back-to-home bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-3 px-6 rounded-lg transition-colors">
                    Voltar para o In√≠cio
                </button>
            </footer>
        </div>

    </div>

    <!-- Modais -->
    <div id="study-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0" role="dialog" aria-modal="true" aria-labelledby="study-title">
        <div class="modal-container bg-white w-full max-w-md rounded-xl shadow-2xl p-6 md:p-8 relative transform scale-95 opacity-0">
            <h3 id="study-title" class="text-2xl font-bold text-indigo-700 mb-4">
                <span class="professor-icon">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                </span> <span id="study-modal-title-text"></span>
            </h3>
            <div id="study-content-wrapper">
                <div id="study-loading-area" class="flex flex-col justify-center items-center h-40 hidden">
                    <div class="spinner mb-2"></div>
                    <p class="text-slate-600 font-semibold">Carregando material de estudo...</p>
                </div>
                <div id="study-text" class="text-slate-600 space-y-3 prose max-w-none hidden"></div>
            </div>
            <button id="close-study-modal" class="absolute top-4 right-4 text-slate-500 hover:text-slate-800 transition-colors" aria-label="Fechar explica√ß√£o">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
    </div>

    <div id="appeal-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0" role="dialog" aria-modal="true" aria-labelledby="appeal-title">
        <div class="modal-container bg-white w-full max-w-md rounded-xl shadow-2xl p-6 md:p-8 relative transform scale-95 opacity-0">
            <h3 id="appeal-title" class="text-2xl font-bold text-orange-700 mb-4">
                <svg class="w-6 h-6 inline-block mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                </svg>
                Recurso da Quest√£o
            </h3>
            <p class="text-slate-600 mb-4">Explique por que voc√™ acredita que a resposta est√° incorreta ou que sua resposta deveria ser considerada correta.</p>
            <textarea id="appeal-text-area" class="w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 mb-4 h-32 resize-y" placeholder="Digite seu recurso aqui..."></textarea>
            <div id="appeal-response-container" class="bg-slate-50 p-3 rounded-lg border border-slate-200 hidden">
                <p class="font-semibold text-slate-700 mb-2">Avalia√ß√£o do Gramatiquinho:</p>
                <div class="flex justify-center items-center h-16 hidden">
                    <div class="spinner"></div>
                </div>
                <p id="appeal-response-text" class="text-slate-600"></p>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button id="submit-appeal-btn" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-5 rounded-lg transition-colors shadow-lg">
                    Enviar Recurso
                </button>
                <button id="close-appeal-modal-btn" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-2 px-5 rounded-lg transition-colors">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <div id="question-distribution-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0" role="dialog" aria-modal="true" aria-labelledby="distribution-title">
        <div class="modal-container bg-white w-full max-w-md rounded-xl shadow-2xl p-6 md:p-8 relative transform scale-95 opacity-0">
            <h3 id="distribution-title" class="text-2xl font-bold text-indigo-700 mb-4">Distribuir Quest√µes por T√≥pico</h3>
            <p class="text-slate-600 mb-4">Defina quantas quest√µes voc√™ quer de cada t√≥pico selecionado. O total deve ser <span id="expected-total-questions" class="font-bold"></span>.</p>
            
            <div id="question-distribution-container" class="max-h-60 overflow-y-auto pr-2 mb-4 space-y-3"></div>

            <div class="flex justify-between items-center mb-4">
                <button id="randomize-distribution-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-md">
                    Distribuir Aleatoriamente
                </button>
                <p class="text-slate-700 font-semibold">Total Atual: <span id="distribution-total-display" class="font-bold text-sky-700">0</span></p>
            </div>
            <p id="distribution-error-message" class="text-red-500 text-sm mb-4 hidden">A soma das quest√µes n√£o corresponde ao total esperado.</p>

            <div class="flex justify-end gap-3 mt-6">
                <button id="confirm-distribution-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-5 rounded-lg transition-colors shadow-lg opacity-50 cursor-not-allowed" disabled>
                    Confirmar e Iniciar Simulado
                </button>
                <button id="cancel-distribution-btn" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-2 px-5 rounded-lg transition-colors">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <div id="performance-report-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0" role="dialog" aria-modal="true" aria-labelledby="report-title">
        <div class="modal-container bg-white w-full max-w-md rounded-xl shadow-2xl p-6 md:p-8 relative transform scale-95 opacity-0">
            <h3 id="report-title" class="text-2xl font-bold text-indigo-700 mb-4">Relat√≥rio de Desempenho</h3>
            <div id="performance-report-content" class="text-slate-600 space-y-2 max-h-60 overflow-y-auto pr-2 mb-4"></div>
            <div class="flex justify-end mt-4">
                <button id="close-report-modal-btn" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-2 px-5 rounded-lg transition-colors">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <div id="num-questions-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0" role="dialog" aria-modal="true" aria-labelledby="num-questions-title">
        <div class="modal-container bg-white w-full max-w-xs rounded-xl shadow-2xl p-6 md:p-8 relative transform scale-95 opacity-0">
            <h3 id="num-questions-title" class="text-2xl font-bold text-blue-700 mb-4">N√∫mero de Quest√µes</h3>
            <label for="modal-question-quantity-input" class="block text-slate-700 font-semibold mb-2">Quantidade:</label>
            <input type="number" id="modal-question-quantity-input" value="10" min="1" class="w-full p-2 border border-slate-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
            <div class="flex justify-end gap-3 mt-6">
                <button id="confirm-num-questions" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg transition-colors shadow-lg">
                    Confirmar
                </button>
                <button id="cancel-num-questions" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-2 px-5 rounded-lg transition-colors">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <div id="difficulty-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0" role="dialog" aria-modal="true" aria-labelledby="difficulty-title">
        <div class="modal-container bg-white w-full max-w-xs rounded-xl shadow-2xl p-6 md:p-8 relative transform scale-95 opacity-0">
            <h3 id="difficulty-title" class="text-2xl font-bold text-purple-700 mb-4">N√≠vel</h3>
            <div class="flex flex-col gap-3">
                <input type="radio" id="modal-difficulty-iniciante" name="modalDifficulty" value="iniciante" class="hidden">
                <label for="modal-difficulty-iniciante" class="difficulty-label px-4 py-2 border border-slate-300 rounded-lg cursor-pointer hover:bg-slate-200 transition-colors text-slate-700 text-center">Iniciante</label>
                <input type="radio" id="modal-difficulty-intermediario" name="modalDifficulty" value="intermediario" class="hidden">
                <label for="modal-difficulty-intermediario" class="difficulty-label px-4 py-2 border border-slate-300 rounded-lg cursor-pointer hover:bg-slate-200 transition-colors text-slate-700 text-center">Intermedi√°rio</label>
                <input type="radio" id="modal-difficulty-avancado" name="modalDifficulty" value="avancado" class="hidden">
                <label for="modal-difficulty-avancado" class="difficulty-label px-4 py-2 border border-slate-300 rounded-lg cursor-pointer hover:bg-slate-200 transition-colors text-slate-700 text-center">Avan√ßado</label>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button id="confirm-difficulty" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-5 rounded-lg transition-colors shadow-lg">
                    Confirmar
                </button>
                <button id="cancel-difficulty" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-2 px-5 rounded-lg transition-colors">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <div id="response-mode-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0" role="dialog" aria-modal="true" aria-labelledby="response-mode-title">
        <div class="modal-container bg-white w-full max-w-xs rounded-xl shadow-2xl p-6 md:p-8 relative transform scale-95 opacity-0">
            <h3 id="response-mode-title" class="text-2xl font-bold text-orange-700 mb-4">Tipo de Gabarito</h3>
            <div class="flex flex-col gap-3">
                <input type="radio" id="modal-response-mode-certo-errado" name="modalResponseMode" value="certo-errado" class="hidden">
                <label for="modal-response-mode-certo-errado" class="response-mode-label px-4 py-2 border border-slate-300 rounded-lg cursor-pointer hover:bg-slate-200 transition-colors text-slate-700 text-center">Certo ou Errado</label>
                <input type="radio" id="modal-response-mode-multipla-escolha" name="modalResponseMode" value="multipla-escolha" class="hidden">
                <label for="modal-response-mode-multipla-escolha" class="response-mode-label px-4 py-2 border border-slate-300 rounded-lg cursor-pointer hover:bg-slate-200 transition-colors text-slate-700 text-center">M√∫ltipla Escolha (5 op√ß√µes)</label>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button id="confirm-response-mode" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-5 rounded-lg transition-colors shadow-lg">
                    Confirmar
                </button>
                <button id="cancel-response-mode" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-2 px-5 rounded-lg transition-colors">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <div id="text-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0" role="dialog" aria-modal="true" aria-labelledby="text-modal-title">
        <div class="modal-container bg-white w-full max-w-2xl rounded-xl shadow-2xl p-6 md:p-8 relative transform scale-95 opacity-0">
            <h3 id="text-modal-title" class="text-2xl font-bold text-indigo-700 mb-4">Texto de Apoio</h3>
            <div id="text-modal-content" class="text-modal-content"></div>
            <button id="close-text-modal" class="absolute top-4 right-4 text-slate-500 hover:text-slate-800 transition-colors" aria-label="Fechar texto">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
    </div>

    <div id="modal-config-redacao" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0" role="dialog" aria-modal="true" aria-labelledby="config-redacao-title">
        <div class="modal-container bg-white w-full max-w-md rounded-xl shadow-2xl p-6 md:p-8 relative transform scale-95 opacity-0">
            <h3 id="config-redacao-title" class="text-2xl font-bold text-purple-700 mb-4">Configurar Reda√ß√£o</h3>
            <div class="mb-4">
                <label for="select-tipo-redacao" class="block text-slate-700 font-semibold mb-2">Tipo de Reda√ß√£o:</label>
                <select id="select-tipo-redacao" class="w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <option value="dissertacao-expositiva">Reda√ß√£o dissertativa expositiva</option>
                    <option value="dissertacao-argumentativa">Reda√ß√£o dissertativa argumentativa (ENEM)</option>
                    <option value="narrativa">Reda√ß√£o narrativa</option>
                    <option value="descritiva">Reda√ß√£o descritiva</option>
                    <option value="injuntiva">Reda√ß√£o injuntiva (ou instrucional)</option>
                    <option value="expositiva">Reda√ß√£o expositiva</option>
                    <option value="carta-pessoal">Carta pessoal</option>
                    <option value="carta-argumentativa">Carta argumentativa</option>
                    <option value="carta-do-leitor">Carta do leitor</option>
                    <option value="relato-ou-relatorio">Relato ou relat√≥rio</option>
                    <option value="cronica">Cr√¥nica</option>
                    <option value="artigo-de-opiniao">Artigo de opini√£o</option>
                    <option value="resumo">Resumo</option>
                    <option value="resenha-critica">Resenha cr√≠tica</option>
                    <option value="estudo-de-caso">Estudo de caso</option>
                </select>
            </div>
            <div class="mb-4">
                <label for="input-quantidade-linhas" class="block text-slate-700 font-semibold mb-2">Quantidade de linhas:</label>
                <input type="number" id="input-quantidade-linhas" value="30" min="10" max="60" class="w-full p-3 border border-slate-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button id="confirm-config-redacao" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-5 rounded-lg transition-colors shadow-lg">
                    Confirmar
                </button>
                <button id="cancel-config-redacao" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-2 px-5 rounded-lg transition-colors">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <div id="modal-gerar-tema" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0" role="dialog" aria-modal="true" aria-labelledby="gerar-tema-title">
        <div class="modal-container bg-white w-full max-w-md rounded-xl shadow-2xl p-6 md:p-8 relative transform scale-95 opacity-0">
            <h3 id="gerar-tema-title" class="text-2xl font-bold text-blue-700 mb-4">Gerar Tema de Reda√ß√£o</h3>
            <div class="flex flex-col gap-4 mb-4">
                <button id="btn-temas-atuais" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg">
                    Temas Atuais
                </button>
                <button id="btn-temas-disciplina" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg">
                    Temas Ligados √† Disciplina
                </button>
            </div>
            <div id="disciplina-select-container" class="mb-4 hidden">
                <label for="select-disciplina-tema" class="block text-slate-700 font-semibold mb-2">Selecione a Disciplina:</label>
                <select id="select-disciplina-tema" class="w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"></select>
            </div>
            <div id="current-theme-input-container" class="mb-4 hidden">
                <label for="current-theme-input" class="block text-slate-700 font-semibold mb-2">Que tipo de tema atual?</label>
                <input type="text" id="current-theme-input" class="w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ex: Meio ambiente, tecnologia, sa√∫de p√∫blica...">
            </div>

            <div id="tema-loading-area" class="flex flex-col justify-center items-center h-20 hidden">
                <div class="spinner mb-2"></div>
                <p class="text-slate-600 font-semibold">Gerando tema...</p>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button id="confirm-gerar-tema" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-5 rounded-lg transition-colors shadow-lg opacity-50 cursor-not-allowed" disabled>
                    Gerar Tema
                </button>
                <button id="cancel-gerar-tema" class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-2 px-5 rounded-lg transition-colors">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <div id="help-tips-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0" role="dialog" aria-modal="true" aria-labelledby="help-tips-title">
        <div class="modal-container bg-white w-full max-w-md rounded-xl shadow-2xl p-6 md:p-8 relative transform scale-95 opacity-0">
            <h3 id="help-tips-title" class="text-2xl font-bold text-indigo-700 mb-4">Dicas para <span id="help-tips-section-name"></span></h3>
            <div id="help-tips-loading-area" class="flex flex-col justify-center items-center h-20 hidden">
                <div class="spinner mb-2"></div>
                <p class="text-slate-600 font-semibold">Gerando dicas...</p>
            </div>
            <div id="help-tips-content" class="text-slate-600 space-y-3 prose max-w-none min-h-[100px] flex items-center justify-center"></div>
            <div class="flex justify-between items-center mt-6">
                <button id="prev-tip-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-lg flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    Anterior
                </button>
                <span id="tip-counter" class="text-slate-600 text-sm"></span>
                <button id="next-tip-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors shadow-lg flex items-center">
                    Pr√≥xima
                    <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                </button>
            </div>
            <div class="flex justify-center mt-4">
                <button id="generate-more-tips-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-5 rounded-lg transition-colors shadow-lg">
                    Gerar Mais Dicas
                </button>
            </div>
            <button id="close-help-tips-modal" class="absolute top-4 right-4 text-slate-500 hover:text-slate-800 transition-colors" aria-label="Fechar dicas">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
    </div>


    <script type="module">
        console.log("GRAMATIQU√äS app script loaded. Version 2.0"); // Added for debugging load issues

        let currentLevel = null;
        let selectedTopics = [];
        let questionQuantity = 10;
        let difficulty = null;
        let responseMode = null;
        let quizQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let isSimulado = false;
        let timerInterval = null;
        let timeLeft = 0;
        let friendsHelpCount = 3;
        let performanceReport = {};
        let currentQuestionData = null;
        let essayType = 'dissertacao-argumentativa';
        let essayLineQuantity = 30;
        let generatedEssayTheme = '';
        let essayTitle = '';
        let currentTips = [];
        let currentTipIndex = 0;
        let currentHelpSection = '';

        const homeScreen = document.getElementById('home-screen');
        const topicSelectionScreen = document.getElementById('topic-selection-screen');
        const simuladoSetupScreen = document.getElementById('simulado-setup-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const finalScreen = document.getElementById('final-screen');
        const essayCorrectionScreen = document.getElementById('essay-correction-screen');
        const lawsScreen = document.getElementById('laws-screen');
        const levelSelectButtons = document.querySelectorAll('.level-select-btn');
        const enterAppButton = document.getElementById('enter-app-btn');
        const levelSelectionSection = document.getElementById('level-selection-section');
        const topicContainerQuiz = document.getElementById('topic-container-quiz');
        const topicContainerSimulado = document.getElementById('topic-container-simulado');
        const questionQuantityQuizInput = document.getElementById('question-quantity-quiz');
        const startSelectedQuizButton = document.getElementById('start-selected-quiz');
        const btnNumQuestions = document.getElementById('btn-num-questions');
        const displayNumQuestions = document.getElementById('display-num-questions');
        const btnDifficulty = document.getElementById('btn-difficulty');
        const displayDifficulty = document.getElementById('display-difficulty');
        const btnResponseMode = document.getElementById('btn-response-mode');
        const displayResponseMode = document.getElementById('display-response-mode');
        const startSimuladoButton = document.getElementById('start-simulado');
        const quizTopicTitle = document.getElementById('quiz-topic-title');
        const questionCounter = document.getElementById('question-counter');
        const scoreDisplay = document.getElementById('score');
        const nextQuestionButton = document.getElementById('next-question');
        const backToMenuButton = document.getElementById('back-to-menu');
        const askFriendsButton = document.getElementById('ask-friends-btn');
        const friendsHelpCountSpan = document.getElementById('friends-help-count');
        const appealQuestionButton = document.getElementById('appeal-question-btn');
        const showTextButton = document.getElementById('show-text-button');
        const timerDisplayContainer = document.getElementById('timer-display-container');
        const timerDisplay = document.getElementById('timer-display');
        const finalScoreDisplay = document.getElementById('final-score');
        const finalTopicDisplay = document.getElementById('final-topic');
        const finalTimeDisplay = document.getElementById('final-time');
        const restartQuizButton = document.getElementById('restart-quiz');
        const backToMenuFinalButton = document.getElementById('back-to-menu-final');
        const studyModal = document.getElementById('study-modal');
        const studyModalTitleText = document.getElementById('study-modal-title-text');
        const studyLoadingArea = document.getElementById('study-loading-area');
        const studyText = document.getElementById('study-text');
        const closeStudyModalButton = document.getElementById('close-study-modal');
        const appealModal = document.getElementById('appeal-modal');
        const appealTextArea = document.getElementById('appeal-text-area');
        const appealResponseContainer = document.getElementById('appeal-response-container');
        const appealResponseLoading = appealModal.querySelector('.spinner');
        const appealResponseText = document.getElementById('appeal-response-text');
        const submitAppealButton = document.getElementById('submit-appeal-btn');
        const closeAppealModalButton = document.getElementById('close-appeal-modal-btn');
        const questionDistributionModal = document.getElementById('question-distribution-modal');
        const expectedTotalQuestionsSpan = document.getElementById('expected-total-questions');
        const questionDistributionContainer = document.getElementById('question-distribution-container');
        const randomizeDistributionBtn = document.getElementById('randomize-distribution-btn');
        const distributionTotalDisplay = document.getElementById('distribution-total-display');
        const distributionErrorMessage = document.getElementById('distribution-error-message');
        const confirmDistributionBtn = document.getElementById('confirm-distribution-btn');
        const cancelDistributionBtn = document.getElementById('cancel-distribution-btn');
        const performanceReportModal = document.getElementById('performance-report-modal');
        const performanceReportContent = document.getElementById('performance-report-content');
        const closeReportModalBtn = document.getElementById('close-report-modal-btn');
        const numQuestionsModal = document.getElementById('num-questions-modal');
        const modalQuestionQuantityInput = document.getElementById('modal-question-quantity-input');
        const confirmNumQuestionsBtn = document.getElementById('confirm-num-questions');
        const cancelNumQuestionsBtn = document.getElementById('cancel-num-questions');
        const difficultyModal = document.getElementById('difficulty-modal');
        const modalDifficultyRadios = document.querySelectorAll('input[name="modalDifficulty"]'); 
        const confirmDifficultyBtn = document.getElementById('confirm-difficulty');
        const cancelDifficultyBtn = document.getElementById('cancel-difficulty');
        const responseModeModal = document.getElementById('response-mode-modal');
        const modalResponseModeRadios = document.querySelectorAll('input[name="modalResponseMode"]'); 
        const confirmResponseModeBtn = document.getElementById('confirm-response-mode');
        const cancelResponseModeBtn = document.getElementById('cancel-response-mode');
        const textModal = document.getElementById('text-modal');
        const textModalTitle = document.getElementById('text-modal-title');
        const textModalContent = document.getElementById('text-modal-content');
        const closeTextModalButton = document.getElementById('close-text-modal');
        const essayTitleInput = document.getElementById('essay-title-input');
        const introInput = document.getElementById('intro-input');
        const devInput = document.getElementById('dev-input');
        const concInput = document.getElementById('conc-input');
        const correctEssayBtn = document.getElementById('correct-essay-btn');
        const essayFeedback = document.getElementById('essay-feedback');
        const correctionLoadingArea = document.getElementById('correction-loading-area');
        const realtimeCorrectionPopupsContainer = document.getElementById('realtime-correction-popups');
        const postCorrectionActions = document.getElementById('post-correction-actions');
        const redoSameThemeBtn = document.getElementById('redo-same-theme-btn');
        const redoNewThemeBtn = document.getElementById('redo-new-theme-btn');
        const downloadEssayPdfBtn = document.getElementById('download-essay-pdf-btn');
        const pdfLoadingArea = document.getElementById('pdf-loading-area');
        const modalConfigRedacao = document.getElementById('modal-config-redacao');
        const selectTipoRedacao = document.getElementById('select-tipo-redacao');
        const inputQuantidadeLinhas = document.getElementById('input-quantidade-linhas');
        const confirmConfigRedacaoBtn = document.getElementById('confirm-config-redacao');
        const cancelConfigRedacaoBtn = document.getElementById('cancel-config-redacao');
        const generateThemeBtn = document.getElementById('generate-theme-btn');
        const modalGerarTema = document.getElementById('modal-gerar-tema');
        const btnTemasAtuais = document.getElementById('btn-temas-atuais');
        const btnTemasDisciplina = document.getElementById('btn-temas-disciplina');
        const disciplinaSelectContainer = document.getElementById('disciplina-select-container');
        const selectDisciplinaTema = document.getElementById('select-disciplina-tema');
        const currentThemeInputContainer = document.getElementById('current-theme-input-container');
        const currentThemeInput = document.getElementById('current-theme-input');
        const temaLoadingArea = document.getElementById('tema-loading-area');
        const confirmGerarTemaBtn = document.getElementById('confirm-gerar-tema');
        const cancelGerarTemaBtn = document.getElementById('cancel-gerar-tema');
        const themeDisplay = document.getElementById('theme-display');
        const generatedThemeText = document.getElementById('generated-theme-text');
        const helpTipsModal = document.getElementById('help-tips-modal');
        const helpTipsTitle = document.getElementById('help-tips-title');
        const helpTipsSectionName = document.getElementById('help-tips-section-name');
        const helpTipsLoadingArea = document.getElementById('help-tips-loading-area');
        const helpTipsContent = document.getElementById('help-tips-content');
        const prevTipBtn = document.getElementById('prev-tip-btn');
        const nextTipBtn = document.getElementById('next-tip-btn');
        const tipCounter = document.getElementById('tip-counter');
        const closeHelpTipsModalBtn = document.getElementById('close-help-tips-modal');
        const helpButtons = document.querySelectorAll('.help-button-icon');
        const generateMoreTipsBtn = document.getElementById('generate-more-tips-btn');
        // Define loadingText here
        const loadingText = document.querySelector('#loading-area p');

        // DOM elements for quiz screen, now correctly defined
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const progressBar = document.getElementById('progress-bar');
        
        // New: Search input for topics
        const topicSearchInput = document.getElementById('topic-search-input');


        const grammarData = [
            {
                category: "L√≠ngua Portuguesa",
                levels: ["enem"], // Removido "redacao" daqui
                subCategories: [
                    {
                        name: "Fonologia e Ortografia",
                        topics: [
                            { id: 'fonemas', name: 'Fonemas e Letras', description: 'Diferen√ßa entre fonemas e letras, d√≠grafos e encontros consonantais.' },
                            { id: 'encontros-vocalicos', name: 'Encontros Voc√°licos (Ditongo, Tritongo, Hiato)', description: 'Conceito e identifica√ß√£o de ditongos, tritongos e hiatos.' },
                            { id: 'divisao-silabica', name: 'Divis√£o Sil√°bica', description: 'Regras de divis√£o sil√°bicas, incluindo casos especiais.' },
                            { id: 'acentuacao', name: 'Acentua√ß√£o Gr√°fica', description: 'Regras de ox√≠tonas, parox√≠tonas, proparox√≠tonas, hiatos e ditongos abertos.' },
                            { id: 'ortografia', name: 'Ortografia', description: 'Uso correto das letras (s/z, g/j, x/ch, etc.) e o novo acordo ortogr√°fico.' },
                            { id: 'hifen', name: 'Uso do H√≠fen', description: 'Regras de uso do h√≠fen em diferentes contextos e o novo acordo ortogr√°fico.' }
                        ]
                    },
                    {
                        name: "Morfologia",
                        topics: [
                            { id: 'substantivo', name: 'Substantivo', description: 'Classifica√ß√£o, flex√£o de g√™nero, n√∫mero e grau dos substantivos.' },
                            { id: 'adjetivo', name: 'Adjetivo', description: 'Classifica√ß√£o, flex√£o de g√™nero, n√∫mero e grau dos adjetivos.' },
                            { id: 'artigo', name: 'Artigo', description: 'Definidos e indefinidos, seu uso e import√¢ncia.' },
                            { id: 'numeral', name: 'Numeral', description: 'Classifica√ß√£o e uso dos numerais (cardinais, ordinais, multiplicativos, fracion√°rios).' },
                            { id: 'pronome', name: 'Pronome', description: 'Classifica√ß√£o (pessoal, possessivo, demonstrativo, etc.) e seu uso.' },
                            { id: 'verbo', name: 'Verbo', description: 'Conjuga√ß√£o, tempos e modos verbais, verbos regulares e irregulares.' },
                            { id: 'adverbio', name: 'Adv√©rbio', description: 'Classifica√ß√£o (tempo, lugar, modo, etc.) e locu√ß√£o adverbial.' },
                            { id: 'preposicao', name: 'Preposi√ß√£o', description: 'Conceito, classifica√ß√£o e combina√ß√£o de preposi√ß√µes.' },
                            { id: 'conjuncao', name: 'Conjun√ß√£o', description: 'Coordenativas e subordinativas, seu papel na conex√£o de ora√ß√µes.' },
                            { id: 'interjeicao', name: 'Interjei√ß√£o', description: 'Express√£o de emo√ß√µes e sentimentos.' },
                            { id: 'estrutura-formacao-palavras', name: 'Estrutura e Forma√ß√£o das Palavras', description: 'Estudo de morfemas (radical, afixos, desin√™ncias), processos de forma√ß√£o (deriva√ß√£o prefixal, sufixal, parassint√©tica, regressiva, impr√≥pria) e composi√ß√£o (justaposi√ß√£o, aglutina√ß√£o).' }
                        ]
                    },
                    {
                        name: "Sintaxe",
                        topics: [
                            { id: 'termos-essenciais', name: 'Termos Essenciais da Ora√ß√£o (Sujeito e Predicado)', description: 'Identifica√ß√£o e classifica√ß√£o de sujeito e predicado.' },
                            { id: 'termos-integrantes', name: 'Termos Integrantes da Ora√ß√£o (Objetos, Complemento Nominal, Agente da Passiva)', description: 'Fun√ß√µes sint√°ticas de objeto direto, indireto, complemento nominal e agente da passiva.' },
                            { id: 'termos-acessorios', name: 'Termos Acess√≥rios da Ora√ß√£o (Adjunto Adnominal, Adjunto Adverbial, Aposto, Vocativo)', description: 'Fun√ß√µes sint√°ticas de adjunto adnominal, adjunto adverbial, aposto e vocativo.' },
                            { id: 'concordancia-verbal', name: 'Concord√¢ncia Verbal', description: 'Regras de concord√¢ncia do verbo com o sujeito.' },
                            { id: 'concordancia-nominal', name: 'Concord√¢ncia Nominal', description: 'Regras de concord√¢ncia entre substantivo, adjetivo, artigo, pronome e numeral.' },
                            { id: 'regencia-verbal', name: 'Reg√™ncia Verbal', description: 'Rela√ß√£o entre o verbo e seus complementos.' },
                            { id: 'regencia-nominal', name: 'Reg√™ncia Nominal', description: 'Rela√ß√£o entre o nome (substantivo, adjetivo, adv√©rbio) e seu complemento.' },
                            { id: 'crase', name: 'Crase', description: 'Regras de uso do acento grave indicativo de crase.' },
                            { id: 'colocacao-pronominal', name: 'Coloca√ß√£o Pronominal (Pr√≥clise, Mes√≥clise, √änclise)', description: 'Regras de posicionamento dos pronomes obl√≠quos √°tonos.' },
                            { id: 'vozes-verbais', name: 'Vozes Verbais (Ativa, Passiva, Reflexiva)', description: 'Identifica√ß√£o e transforma√ß√£o das vozes verbais.' },
                            { id: 'periodo-simples-composto', name: 'Per√≠odo Simples e Per√≠odo Composto', description: 'Diferen√ßa entre ora√ß√µes e per√≠odos, coordena√ß√£o e subordina√ß√£o.' },
                            { id: 'oracoes-coordenadas', name: 'Ora√ß√µes Coordenadas', description: 'Classifica√ß√£o e uso das ora√ß√µes coordenadas (sind√©ticas e assind√©ticas).' },
                            { id: 'oracoes-subordinadas-substantivas', name: 'Ora√ß√µes Subordinadas Substantivas', description: 'Classifica√ß√£o e fun√ß√£o das ora√ß√µes subordinadas substantivas.' },
                            { id: 'oracoes-subordinadas-adjetivas', name: 'Ora√ß√µes Subordinadas Adjetivas', description: 'Classifica√ß√£o e fun√ß√£o das ora√ß√µes subordinadas adjetivas.' },
                            { id: 'oracoes-subordinadas-adverbiais', name: 'Ora√ß√µes Subordinadas Adverbiais', description: 'Classifica√ß√£o e fun√ß√£o das ora√ß√µes subordinadas adverbiais.' },
                            { id: 'oracoes-reduzidas', name: 'Ora√ß√µes Reduzidas', description: 'Conceito e classifica√ß√£o de ora√ß√µes reduzidas (infinitivo, ger√∫ndio, partic√≠pio).' },
                            { id: 'funcoes-que-se', name: 'Fun√ß√µes do "Que" e do "Se"', description: 'An√°lise sint√°tica e morfol√≥gica das palavras "que" e "se".' },
                            { id: 'pontuacao', name: 'Pontua√ß√£o (V√≠rgula, Ponto e V√≠rgula, Dois Pontos, Aspas, Par√™nteses)', description: 'Regras gerais e espec√≠ficas de pontua√ß√£o.' }
                        ]
                    },
                    {
                        name: "Sem√¢ntica e Estil√≠stica",
                        topics: [
                            { id: 'sinonimia-antonimia', name: 'Sinon√≠mia e Anton√≠mia', description: 'Rela√ß√µes de sentido entre as palavras.' },
                            { id: 'homonimia-paronimia', name: 'Homon√≠mia e Paron√≠mia', description: 'Palavras com sons ou grafias semelhantes, mas significados diferentes.' },
                            { id: 'polissemia', name: 'Polissemia', description: 'M√∫ltiplos significados de uma mesma palavra.' },
                            { id: 'conotacao-denotacao', name: 'Conota√ß√£o e Denota√ß√£o', description: 'Sentido real e figurado das palavras.' },
                            { id: 'figuras-linguagem', name: 'Figuras de Linguagem', description: 'Met√°fora, compara√ß√£o, personifica√ß√£o, hip√©rbole, eufemismo, etc.' },
                            { id: 'vicios-linguagem', name: 'V√≠cios de Linguagem', description: 'Ambiguidade, pleonasmo, cacofonia, barbarismo, etc.' }
                        ]
                    },
                    {
                        name: "Interpreta√ß√£o e Produ√ß√£o Textual",
                        topics: [
                            { id: 'leitura-interpretacao', name: 'Leitura e Interpreta√ß√£o de Textos', description: 'An√°lise de textos liter√°rios e n√£o liter√°rios, identifica√ß√£o de informa√ß√µes impl√≠citas e expl√≠citas, intertextualidade.' },
                            { id: 'tipos-generos-textuais', name: 'Tipos e G√™neros Textuais', description: 'Diferen√ßa entre narra√ß√£o, descri√ß√£o, disserta√ß√£o, injun√ß√£o e seus g√™neros.' },
                            { id: 'coesao-coerencia', name: 'Coes√£o e Coer√™ncia Textual', description: 'Mecanismos para garantir a fluidez e o sentido do texto.' },
                            { id: 'inferencia-deducao', name: 'Infer√™ncia e Dedu√ß√£o', description: 'Capacidade de extrair informa√ß√µes impl√≠citas e expl√≠citas do texto.' },
                            { id: 'elementos-narrativos', name: 'Elementos Narrativos (Enredo, Personagens, Narrador, Tempo, Espa√ßo)', description: 'An√°lise dos componentes de uma narrativa.' },
                            { id: 'argumentacao', name: 'Argumenta√ß√£o', description: 'Identifica√ß√£o de teses, argumentos e estrat√©gias argumentativas.' }
                        ]
                    },
                    {
                        name: "Literatura",
                        topics: [
                            { id: 'trovadorismo', name: 'Trovadorismo e Humanismo', description: 'Contexto hist√≥rico, caracter√≠sticas e principais autores.' },
                            { id: 'classicismo', name: 'Classicismo', description: 'Renascimento, Cam√µes e a epopeia portuguesa.' },
                            { id: 'barroco', name: 'Barroco', description: 'Contexto, caracter√≠sticas e principais autores (Greg√≥rio de Matos, Padre Ant√¥nio Vieira).' },
                            { id: 'arcadismo', name: 'Arcadismo', description: 'Contexto, caracter√≠sticas e principais autores (Tom√°s Ant√¥nio Gonzaga, Cl√°udio Manuel da Costa).' },
                            { id: 'romantismo', name: 'Romantismo', description: 'Tr√™s gera√ß√µes do Romantismo no Brasil e em Portugal, caracter√≠sticas e autores.' },
                            { id: 'realismo-naturalismo', name: 'Realismo e Naturalismo', description: 'Contexto, caracter√≠sticas e principais autores (Machado de Assis, Alu√≠sio Azevedo).' },
                            { id: 'parnasianismo-simbolismo', name: 'Parnasianismo e Simbolismo', description: 'Caracter√≠sticas e principais autores de cada escola.' },
                            { id: 'pre-modernismo', name: 'Pr√©-Modernismo', description: 'Transi√ß√£o, caracter√≠sticas e autores (Euclides da Cunha, Lima Barreto).' },
                            { id: 'modernismo-1fase', name: 'Modernismo - 1¬™ Fase', description: 'Semana de Arte Moderna, caracter√≠sticas e autores (M√°rio de Andrade, Oswald de Andrade).' },
                            { id: 'modernismo-2fase', name: 'Modernismo - 2¬™ Fase', description: 'Prosa e Poesia, caracter√≠sticas e autores (Graciliano Ramos, Carlos Drummond de Andrade).' },
                            { id: 'modernismo-3fase', name: 'Modernismo - 3¬™ Fase (P√≥s-Modernismo)', description: 'Gera√ß√£o de 45, caracter√≠sticas e autores (Jo√£o Cabral de Melo Neto, Clarice Lispector).' },
                            { id: 'literatura-contemporanea', name: 'Literatura Contempor√¢nea', description: 'Tend√™ncias atuais na literatura brasileira.' }
                        ]
                    },
                    {
                        name: "Lingu√≠stica",
                        topics: [
                            { id: 'linguistica-geral', name: 'Lingu√≠stica Geral', description: 'Conceitos fundamentais da lingu√≠stica, como l√≠ngua, fala, signo lingu√≠stico.' },
                            { id: 'fonetica-fonologia', name: 'Fon√©tica e Fonologia', description: 'Estudo dos sons da fala e dos sistemas sonoros das l√≠nguas.' },
                            { id: 'morfologia-linguistica', name: 'Morfologia Lingu√≠stica', description: 'Estudo da estrutura das palavras e seus processos de forma√ß√£o.' },
                            { id: 'sintaxe-linguistica', name: 'Sintaxe Lingu√≠stica', description: 'Estudo da organiza√ß√£o das palavras em frases e ora√ß√µes.' },
                            { id: 'semantica-pragmatica', name: 'Sem√¢ntica e Pragmaticidade', description: 'Estudo do significado e do uso da linguagem em contexto.' },
                            { id: 'sociolinguistica', name: 'Sociolingu√≠stica', description: 'Estudo da rela√ß√£o entre l√≠ngua e sociedade.' },
                            { id: 'psicolinguistica', name: 'Psicolingu√≠stica', description: 'Estudo da rela√ß√£o entre linguagem e processos mentais.' },
                            { id: 'historia-linguistica', name: 'Hist√≥ria da Lingu√≠stica', description: 'Principais escolas e teorias da lingu√≠stica ao longo do tempo.' }
                        ]
                    }
                ]
            },
            {
                category: "Conhecimentos Pedag√≥gicos",
                levels: ["pedagogicos"],
                subCategories: [
                    {
                        name: "Fundamentos da Educa√ß√£o",
                        topics: [
                            { id: 'filosofia-educacao', name: 'Filosofia da Educa√ß√£o', description: 'Principais correntes filos√≥ficas e suas implica√ß√µes na educa√ß√£o.' },
                            { id: 'sociologia-educacao', name: 'Sociologia da Educa√ß√£o', description: 'Rela√ß√£o entre educa√ß√£o e sociedade, desigualdades e movimentos sociais.' },
                            { id: 'historia-educacao', name: 'Hist√≥ria da Educa√ß√£o', description: 'Principais momentos, influ√™ncias e movimentos que moldaram a escola.' },
                            { id: 'tendencias-pedagogicas', name: 'Tend√™ncias Pedag√≥gicas (tradicional, tecnicista, progressista etc.)', description: 'An√°lise das diferentes abordagens e tend√™ncias pedag√≥gicas.' },
                            { id: 'educacao-sociedade', name: 'Educa√ß√£o e Sociedade', description: 'O papel da educa√ß√£o na forma√ß√£o social e cultural.' },
                            { id: 'escola-transformacao-social', name: 'Escola como Espa√ßo de Transforma√ß√£o Social', description: 'O papel da escola na promo√ß√£o da equidade e justi√ßa social.' }
                        ]
                    },
                    {
                        name: "Psicologia da Educa√ß√£o e Desenvolvimento",
                        topics: [
                            { id: 'teorias-desenvolvimento-humano', name: 'Teorias do Desenvolvimento Humano (Piaget, Vygotsky, Wallon, Freud, Erikson)', description: 'Principais teorias e suas contribui√ß√µes para a compreens√£o do desenvolvimento humano.' },
                            { id: 'aprendizagem-desenvolvimento', name: 'Aprendizagem e Desenvolvimento', description: 'Rela√ß√£o entre os processos de aprendizagem e desenvolvimento.' },
                            { id: 'relacao-ensino-aprendizagem', name: 'Rela√ß√£o entre Ensino e Aprendizagem', description: 'Din√¢mica da intera√ß√£o entre professor, aluno e conhecimento.' },
                            { id: 'afetividade-cognicao', name: 'Afetividade e Cogni√ß√£o', description: 'A import√¢ncia da dimens√£o afetiva no processo cognitivo.' }
                        ]
                    },
                    {
                        name: "Did√°tica",
                        topics: [
                            { id: 'planejamento-ensino', name: 'Planejamento de Ensino (anual, bimestral, semanal e di√°rio)', description: 'Etapas e tipos de planejamento para a pr√°tica docente.' },
                            { id: 'objetivos-conteudos-metodos-avaliacao', name: 'Objetivos, Conte√∫dos, M√©todos e Avalia√ß√£o', description: 'Componentes essenciais do planejamento de ensino.' },
                            { id: 'metodologias-ativas', name: 'Metodologias Ativas (sala de aula invertida, projetos, gamifica√ß√£o etc.)', description: 'Abordagens inovadoras para engajar os alunos no processo de aprendizagem.' },
                            { id: 'estrategias-tecnicas-ensino', name: 'Estrat√©gias e T√©cnicas de Ensino', description: 'Recursos e procedimentos para facilitar a aprendizagem.' },
                            { id: 'relacao-professor-aluno', name: 'Rela√ß√£o Professor-Aluno', description: 'A import√¢ncia do v√≠nculo e da intera√ß√£o para o processo educativo.' },
                            { id: 'mediacao-pedagogica', name: 'Media√ß√£o Pedag√≥gica', description: 'O papel do professor como mediador entre o conhecimento e o aluno.' }
                        ]
                    },
                    {
                        name: "Avalia√ß√£o da Aprendizagem",
                        topics: [
                            { id: 'tipos-avaliacao', name: 'Tipos de Avalia√ß√£o (diagn√≥stica, formativa, somativa)', description: 'Classifica√ß√£o e finalidades dos diferentes tipos de avalia√ß√£o.' },
                            { id: 'avaliacao-mediadora', name: 'Avalia√ß√£o Mediadora (Jussara Hoffmann)', description: 'Concep√ß√£o de avalia√ß√£o como processo cont√≠nuo de acompanhamento da aprendizagem.' },
                            { id: 'instrumentos-avaliacao', name: 'Instrumentos de Avalia√ß√£o', description: 'Recursos utilizados para coletar informa√ß√µes sobre a aprendizagem.' },
                            { id: 'conceitos-nota-conceito-rubrica', name: 'Conceitos de Nota, Conceito, Rubrica', description: 'Diferen√ßas e aplica√ß√µes dos sistemas de registro da aprendizagem.' },
                            { id: 'avaliacao-aprendizagem-significativa', name: 'Avalia√ß√£o na Perspectiva da Aprendizagem Significativa', description: 'Avalia√ß√£o que valoriza a constru√ß√£o de sentido e a relev√¢ncia do conhecimento.' }
                        ]
                    },
                    {
                        name: "Planejamento Educacional",
                        topics: [
                            { id: 'projeto-politico-pedagogico', name: 'Projeto Pol√≠tico-Pedag√≥gico (PPP)', description: 'Documento que define a identidade e os objetivos da escola.' },
                            { id: 'plano-desenvolvimento-escola', name: 'Plano de Desenvolvimento da Escola (PDE)', description: 'Planejamento estrat√©gico para a melhoria da qualidade educacional.' },
                            { id: 'plano-aula-ensino', name: 'Plano de Aula e Plano de Ensino', description: 'Instrumentos para organizar a pr√°tica pedag√≥gica em diferentes n√≠veis.' },
                            { id: 'curriculo-escolar', name: 'Curr√≠culo Escolar: concep√ß√µes, organiza√ß√£o e pr√°tica', description: 'O que e como se ensina na escola, e suas diferentes abordagens.' },
                            { id: 'bncc-pedagogicos', name: 'Base Nacional Comum Curricular (BNCC)', description: 'Documento normativo que define o conjunto de aprendizagens essenciais para todos os alunos da Educa√ß√£o B√°sica.' },
                            { id: 'dcn-pedagogicos', name: 'Diretrizes Curriculares Nacionais (DCNs)', description: 'Orienta√ß√µes para a elabora√ß√£o dos curr√≠culos escolares.' },
                            { id: 'campos-experiencia-ei', name: 'Campos de Experi√™ncia (na Educa√ß√£o Infantil)', description: 'Eixos estruturantes do curr√≠culo da Educa√ß√£o Infantil.' }
                        ]
                    },
                    {
                        name: "Gest√£o Escolar e Organiza√ß√£o do Trabalho Pedag√≥gico",
                        topics: [
                            { id: 'gestao-democratica-participativa', name: 'Gest√£o Democr√°tica e Participativa', description: 'Princ√≠pios e pr√°ticas para uma gest√£o escolar que envolva a comunidade.' },
                            { id: 'autonomia-escolar', name: 'Autonomia Escolar', description: 'Capacidade da escola de tomar decis√µes sobre seu funcionamento e projeto pedag√≥gico.' },
                            { id: 'conselho-escolar-gremio', name: 'Conselho Escolar e Gr√™mio Estudantil', description: 'Inst√¢ncias de participa√ß√£o e representa√ß√£o na escola.' },
                            { id: 'funcao-social-escola', name: 'Fun√ß√£o Social da Escola', description: 'O papel da escola na forma√ß√£o cidad√£ e na transforma√ß√£o social.' },
                            { id: 'coordenacao-pedagogica-supervisao', name: 'Coordena√ß√£o Pedag√≥gica e Supervis√£o', description: 'O papel dos profissionais que apoiam e orientam a pr√°tica docente.' },
                            { id: 'clima-cultura-organizacional', name: 'Clima e Cultura Organizacional', description: 'Aspectos que influenciam o ambiente de trabalho e as rela√ß√µes na escola.' },
                            { id: 'trabalho-coletivo-interdisciplinar', name: 'Trabalho Coletivo e Interdisciplinar', description: 'A import√¢ncia da colabora√ß√£o e da integra√ß√£o entre as √°reas do conhecimento.' }
                        ]
                    },
                    {
                        name: "Pol√≠ticas P√∫blicas e Legisla√ß√£o Educacional",
                        topics: [
                            { id: 'ldb-pedagogicos', name: 'LDB (Lei n¬∫ 9.394/1996)', hasQuestions: true, description: 'Lei de Diretrizes e Bases da Educa√ß√£o Nacional.' },
                            { id: 'cf-educacao', name: 'Constitui√ß√£o Federal (art. 205 ao 214)', hasQuestions: true, description: 'Disposi√ß√µes constitucionais sobre a educa√ß√£o.' },
                            { id: 'eca-pedagogicos', name: 'Estatuto da Crian√ßa e do Adolescente (ECA)', hasQuestions: true, description: 'Direitos e deveres de crian√ßas e adolescentes.' },
                            { id: 'pne-pedagogicos', name: 'Plano Nacional de Educa√ß√£o (PNE)', hasQuestions: true, description: 'Metas e estrat√©gias para a educa√ß√£o brasileira.' },
                            { id: 'diretrizes-educacao-inclusiva', name: 'Diretrizes para Educa√ß√£o Inclusiva', hasQuestions: true, description: 'Normas para garantir o acesso e a participa√ß√£o de todos os alunos.' },
                            { id: 'fundeb-financiamento', name: 'Fundeb e Financiamento da Educa√ß√£o', hasQuestions: true, description: 'Mecanismos de financiamento da educa√ß√£o b√°sica.' },
                            { id: 'pcn-pedagogicos', name: 'Par√¢metros Curriculares Nacionais (PCNs)', description: 'Orienta√ß√µes para o curr√≠culo e a pr√°tica pedag√≥gica.' },
                            { id: 'bncc-legislacao', name: 'Base Nacional Comum Curricular (BNCC)', hasQuestions: true, description: 'Documento normativo que define o conjunto de aprendizagens essenciais para todos os alunos da Educa√ß√£o B√°sica.' },
                            { id: 'educacao-direito-subjetivo', name: 'Educa√ß√£o como Direito P√∫blico Subjetivo', description: 'A educa√ß√£o como direito fundamental e dever do Estado.' }
                        ]
                    },
                    {
                        name: "Inclus√£o, Diversidade e Direitos Humanos",
                        topics: [
                            { id: 'educacao-inclusiva-diversidade', name: 'Educa√ß√£o Inclusiva', description: 'Princ√≠pios e pr√°ticas para garantir a participa√ß√£o de todos os alunos.' },
                            { id: 'aee', name: 'Atendimento Educacional Especializado (AEE)', description: 'Recursos e servi√ßos para alunos com necessidades educacionais especiais.' },
                            { id: 'educacao-indigena-campo-quilombola', name: 'Educa√ß√£o Ind√≠gena, do Campo e Quilombola', description: 'Abordagens pedag√≥gicas que valorizam as culturas e realidades desses grupos.' },
                            { id: 'genero-raca-etnia', name: 'G√™nero, Ra√ßa e Etnia na Escola', description: 'A import√¢ncia de abordar as quest√µes de g√™nero, ra√ßa e etnia no ambiente escolar.' },
                            { id: 'cultura-afro-indigena', name: 'Cultura Afro-Brasileira e Ind√≠gena (Lei 10.639/03 e 11.645/08)', hasQuestions: true, description: 'Estudo da hist√≥ria e cultura afro-brasileira e ind√≠gena na educa√ß√£o.' },
                            { id: 'direitos-humanos-cultura-paz', name: 'Direitos Humanos e Cultura de Paz', description: 'Promo√ß√£o dos direitos humanos e da cultura de paz no ambiente escolar.' },
                            { id: 'combate-preconceito-discriminacao', name: 'Combate ao Preconceito e Discrimina√ß√£o', description: 'Estrat√©gias para prevenir e combater o preconceito e a discrimina√ß√£o na escola.' }
                        ]
                    },
                    {
                        name: "Alfabetiza√ß√£o e Letramento",
                        topics: [
                            { id: 'metodos-alfabetizacao', name: 'M√©todos de Alfabetiza√ß√£o (sil√°bico, f√¥nico, construtivista)', description: 'Diferentes abordagens para o ensino da leitura e escrita.' },
                            { id: 'teorias-letramento', name: 'Teorias do Letramento (Magda Soares, Emilia Ferreiro)', description: 'Conceitos e perspectivas sobre o letramento e suas implica√ß√µes pedag√≥gicas.' },
                            { id: 'pnaic-pna-alfabetizacao', name: 'PNAIC, PNA e Pol√≠tica Nacional de Alfabetiza√ß√£o', hasQuestions: true, description: 'Programas e pol√≠ticas para a alfabetiza√ß√£o no Brasil.' },
                            { id: 'alfabetizacao-bncc', name: 'Alfabetiza√ß√£o na Perspectiva da BNCC', description: 'Orienta√ß√µes da BNCC para o processo de alfabetiza√ß√£o.' },
                            { id: 'processos-leitura-escrita', name: 'Processos de Leitura e Escrita', description: 'O desenvolvimento da leitura e escrita na crian√ßa.' }
                        ]
                    },
                    {
                        name: "Tecnologias na Educa√ß√£o",
                        topics: [
                            { id: 'tdics', name: 'Tecnologias Digitais de Informa√ß√£o e Comunica√ß√£o (TDICs)', description: 'Uso de tecnologias digitais no processo de ensino e aprendizagem.' },
                            { id: 'educacao-hibrida', name: 'Educa√ß√£o H√≠brida', description: 'Combina√ß√£o de ensino presencial e a dist√¢ncia.' },
                            { id: 'competencia-digital-docente', name: 'Compet√™ncia Digital Docente', description: 'Habilidades e conhecimentos necess√°rios para o uso pedag√≥gico das tecnologias.' },
                            { id: 'ambientes-virtuais-aprendizagem', name: 'Ambientes Virtuais de Aprendizagem (AVA)', description: 'Plataformas e ferramentas para o ensino online.' },
                            { id: 'recursos-midiaticos-gamificacao', name: 'Recursos Midi√°ticos e Gamifica√ß√£o', description: 'Uso de m√≠dias e elementos de jogos para engajar os alunos.' },
                            { id: 'inclusao-digital', name: 'Inclus√£o Digital', description: 'Acesso e uso das tecnologias digitais por todos.' }
                        ]
                    },
                    {
                        name: "√âtica e Pr√°tica Docente",
                        topics: [
                            { id: 'profissionalizacao-docente', name: 'Profissionaliza√ß√£o Docente', description: 'Aspectos da forma√ß√£o e desenvolvimento profissional do professor.' },
                            { id: 'etica-profissional', name: '√âtica Profissional', description: 'Princ√≠pios √©ticos que norteiam a pr√°tica docente.' },
                            { id: 'codigo-etica-educador', name: 'C√≥digo de √âtica do Educador', description: 'Conjunto de normas e valores que orientam a conduta profissional.' },
                            { id: 'relacao-comunidade-escolar', name: 'Rela√ß√£o com a Comunidade Escolar', description: 'A import√¢ncia da parceria entre a escola e a comunidade.' },
                            { id: 'formacao-continuada-docente', name: 'Forma√ß√£o Continuada', description: 'Processos de atualiza√ß√£o e aprimoramento profissional do professor.' },
                            { id: 'direitos-deveres-professor', name: 'Direitos e Deveres do Professor', description: 'Aspectos legais e √©ticos da atua√ß√£o docente.' }
                        ]
                    },
                    {
                        name: "Educa√ß√£o Infantil e Anos Iniciais",
                        topics: [
                            { id: 'campos-experiencias-ei-detalhe', name: 'Campos de Experi√™ncias (EI)', description: 'Eixos estruturantes do curr√≠culo da Educa√ß√£o Infantil, que organizam o trabalho pedag√≥gico.' },
                            { id: 'direitos-aprendizagem', name: 'Direitos de Aprendizagem', description: 'Direitos assegurados √†s crian√ßas na Educa√ß√£o Infantil, como conviver, brincar, participar, explorar, expressar e conhecer-se.' },
                            { id: 'brincadeira-eixo-estruturante', name: 'Brincadeira como Eixo Estruturante', description: 'A brincadeira como atividade central na Educa√ß√£o Infantil, promovendo o desenvolvimento e a aprendizagem.' },
                            { id: 'desenvolvimento-infantil', name: 'Desenvolvimento Infantil', description: 'Estudo das fases e caracter√≠sticas do desenvolvimento de crian√ßas de 0 a 5 anos e 11 meses.' },
                            { id: 'avaliacao-educacao-infantil', name: 'Avalia√ß√£o na Educa√ß√£o Infantil', description: 'Processo de acompanhamento e registro do desenvolvimento e aprendizagem das crian√ßas, sem objetivo de promo√ß√£o.' },
                            { id: 'interacoes-vinculos-afetivos', name: 'Intera√ß√µes e V√≠nculos Afetivos', description: 'A import√¢ncia das rela√ß√µes e do afeto no desenvolvimento e aprendizagem na Educa√ß√£o Infantil.' }
                        ]
                    },
                    {
                        name: "Avalia√ß√µes em Larga Escala",
                        topics: [
                            { id: 'prova-brasil-saeb', name: 'Prova Brasil e Saeb', hasQuestions: true, description: 'Avalia√ß√µes diagn√≥sticas do sistema de ensino brasileiro.' },
                            { id: 'enem-pedagogicos', name: 'Enem', hasQuestions: true, description: 'Exame Nacional do Ensino M√©dio, utilizado para acesso ao ensino superior.' },
                            { id: 'ideb-pedagogicos', name: 'IDEB', hasQuestions: true, description: '√çndice de Desenvolvimento da Educa√ß√£o B√°sica, que avalia a qualidade da educa√ß√£o.' },
                            { id: 'ana-alfabetizacao', name: 'ANA (Avalia√ß√£o Nacional da Alfabetiza√ß√£o)', hasQuestions: true, description: 'Avalia√ß√£o da alfabetiza√ß√£o de estudantes do 2¬∫ ano do Ensino Fundamental.' },
                            { id: 'aplicacoes-implicacoes-pedagogicas', name: 'Aplica√ß√µes e Implica√ß√µes Pedag√≥gicas dos Resultados', description: 'Como os resultados das avalia√ß√µes em larga escala podem ser utilizados para melhorar a pr√°tica pedag√≥gica.' }
                        ]
                    }
                ]
            },
            {
                category: "Reda√ß√£o",
                levels: ["redacao", "redacao-correcao"], // Mantido "redacao" aqui para Reda√ß√£o - Conte√∫do
                subCategories: [
                    {
                        name: "Fundamentos da Reda√ß√£o",
                        topics: [
                            { id: 'tipos-redacao', name: 'Tipos de Reda√ß√£o (Disserta√ß√£o, Narra√ß√£o, Descri√ß√£o)', description: 'Caracter√≠sticas e estrutura de cada tipo textual.' },
                            { id: 'estrutura-dissertacao', name: 'Estrutura da Disserta√ß√£o-Argumentativa', description: 'Introdu√ß√£o, desenvolvimento e conclus√£o para textos dissertativos.' },
                            { id: 'tese-argumentacao', name: 'Tese e Argumenta√ß√£o', description: 'Como formular uma tese e construir argumentos s√≥lidos.' },
                            { id: 'coerencia-coesao', name: 'Coer√™ncia e Coes√£o Textual', description: 'Mecanismos para garantir a fluidez e o sentido do texto.' },
                            { id: 'norma-culta', name: 'Uso da Norma Culta', description: 'Adequa√ß√£o da linguagem formal em textos dissertativos.' },
                            { id: 'pontuacao-redacao', name: 'Pontua√ß√£o na Reda√ß√£o', description: 'Regras de pontua√ß√£o aplicadas √† escrita formal.' },
                            { id: 'conectivos-articuladores', name: 'Conectivos e Articuladores Textuais', description: 'Uso de conjun√ß√µes e adv√©rbios para ligar ideias.' },
                            { id: 'interpretacao-propostas', name: 'Interpreta√ß√£o de Propostas de Reda√ß√£o', description: 'An√°lise de temas e textos motivadores.' },
                            { id: 'repertorio-sociocultural', name: 'Repert√≥rio Sociocultural', description: 'Como usar conhecimentos de diversas √°reas para enriquecer a argumenta√ß√£o.' },
                            { id: 'citacoes-alusoes', name: 'Uso de Cita√ß√µes e Alus√µes', description: 'Como inserir cita√ß√µes e refer√™ncias de forma adequada.' },
                            { id: 'mecanismos-intervencao', name: 'Mecanismos de Interven√ß√£o (ENEM)', description: 'Propostas de solu√ß√£o para problemas sociais, com foco no ENEM.' },
                            { id: 'vicios-linguagem-redacao', name: 'V√≠cios de Linguagem na Reda√ß√£o', description: 'Identifica√ß√£o e corre√ß√£o de v√≠cios como pleonasmo, ambiguidade, etc.' },
                            { id: 'generos-textuais-redacao', name: 'G√™neros Textuais (Artigo de Opini√£o, Carta Aberta, Resenha)', description: 'An√°lise e produ√ß√£o de diferentes g√™neros textuais.' },
                            { id: 'argumentos-tipos', name: 'Tipos de Argumentos (Autoridade, Exemplifica√ß√£o, Compara√ß√£o)', description: 'Estrat√©gias argumentativas para defender um ponto de vista.' },
                            { id: 'paragrafo', name: 'O Par√°grafo (estrutura e fun√ß√£o)', description: 'Organiza√ß√£o das ideias em par√°grafos coerentes.' },
                            { id: 'ortografia-gramatica-aplicada', name: 'Ortografia e Gram√°tica Aplicada √† Reda√ß√£o', description: 'Revis√£o de regras gramaticais essenciais para a escrita.' },
                            { id: 'estudo-de-caso', name: 'Estudo de Caso', description: 'An√°lise e resolu√ß√£o de problemas pr√°ticos em formato de texto.' }
                        ]
                    }
                ]
            },
            {
                category: "Direito",
                levels: ["bonus"],
                subCategories: [
                    {
                        name: "Direito Constitucional",
                        topics: [
                            { id: 'const-conceitos-iniciais', name: 'Constitui√ß√£o: Conceitos Iniciais', description: 'Conceito, classifica√ß√£o (origem, forma, conte√∫do, finalidade, extens√£o, estabilidade), supremacia e muta√ß√£o constitucional. Poder Constituinte (origin√°rio e derivado).' },
                            { id: 'const-principios-fundamentais', name: 'Princ√≠pios Fundamentais (Art. 1¬∫ ao 4¬∫)', description: 'Fundamentos da Rep√∫blica, objetivos fundamentais, princ√≠pios das rela√ß√µes internacionais, soberania popular, cidadania, dignidade da pessoa humana e pluralismo pol√≠tico.' },
                            { id: 'const-direitos-garantias-fundamentais', name: 'Direitos e Garantias Fundamentais (Art. 5¬∫ ao 17)', description: 'Direitos e Deveres Individuais e Coletivos (Art. 5¬∫): vida, liberdade, igualdade, seguran√ßa, propriedade. Rem√©dios constitucionais (Habeas corpus, Habeas data, Mandado de seguran√ßa, Mandado de injun√ß√£o, A√ß√£o popular). Princ√≠pios da legalidade, anterioridade, contradit√≥rio, ampla defesa. Direitos de reuni√£o, express√£o, cren√ßa, associa√ß√£o.' },
                            { id: 'const-direitos-sociais', name: 'Direitos Sociais', description: 'Educa√ß√£o, sa√∫de, trabalho, moradia, lazer, previd√™ncia etc. Direitos dos trabalhadores urbanos e rurais.' },
                            { id: 'const-nacionalidade', name: 'Nacionalidade', description: 'Origin√°ria e derivada. Perda e reaquisi√ß√£o da nacionalidade.' },
                            { id: 'const-direitos-politicos', name: 'Direitos Pol√≠ticos', description: 'Sufr√°gio e voto. Elegibilidade e inelegibilidades. Direitos de participa√ß√£o pol√≠tica. Perda e suspens√£o de direitos pol√≠ticos.' },
                            { id: 'const-partidos-politicos', name: 'Partidos Pol√≠ticos', description: 'Requisitos para cria√ß√£o e funcionamento. Fidelidade partid√°ria.' },
                            { id: 'const-organizacao-estado', name: 'Organiza√ß√£o do Estado (Art. 18 ao 43)', description: 'Organiza√ß√£o Pol√≠tico-Administrativa: Uni√£o, Estados, Munic√≠pios e Distrito Federal. Reparti√ß√£o de compet√™ncias (art. 21 a 25): exclusiva, privativa, concorrente e comum. Administra√ß√£o P√∫blica: Princ√≠pios (LIMPE), servidores p√∫blicos (regime jur√≠dico, direitos, deveres, responsabilidade, acumula√ß√£o de cargos, acesso a cargos p√∫blicos, teto remunerat√≥rio, estabilidade). Organiza√ß√£o Territorial: Interven√ß√£o federal e estadual. Descentraliza√ß√£o administrativa.' },
                            { id: 'const-organizacao-poderes', name: 'Organiza√ß√£o dos Poderes (Art. 44 ao 135)', description: 'Poder Legislativo: Congresso Nacional (composi√ß√£o e funcionamento), processo legislativo (iniciativa, emenda, vota√ß√£o, san√ß√£o, veto), comiss√µes parlamentares (CPI, permanentes), fiscaliza√ß√£o e controle, imunidades parlamentares. Poder Executivo: Presid√™ncia da Rep√∫blica (atribui√ß√µes e responsabilidades), Ministro de Estado, crimes de responsabilidade. Poder Judici√°rio: Estrutura (STF, STJ, TSE, TRFs, TRTs, TREs, TJ, Juizados etc.), garantias e prerrogativas dos magistrados. Controle de constitucionalidade: Difuso e concentrado, ADI, ADC, ADPF. Efeitos das decis√µes do STF. Fun√ß√µes Essenciais √† Justi√ßa: Minist√©rio P√∫blico, Advocacia p√∫blica e privada, Defensoria P√∫blica.' },
                            { id: 'const-defesa-estado-instituicoes', name: 'Defesa do Estado e das Institui√ß√µes Democr√°ticas (Art. 136 ao 144)', description: 'Estado de defesa, estado de s√≠tio, interven√ß√£o federal. Seguran√ßa p√∫blica: Pol√≠cia federal, civil, militar, rodovi√°ria e penal. For√ßas armadas.' },
                            { id: 'const-ordem-economica-financeira', name: 'Ordem Econ√¥mica e Financeira (Art. 170 ao 192)', description: 'Princ√≠pios da ordem econ√¥mica. Livre iniciativa e fun√ß√£o social da propriedade. Sistema financeiro nacional. Interven√ß√£o do Estado na economia. Atua√ß√£o das empresas p√∫blicas e sociedades de economia mista.' },
                            { id: 'const-ordem-social', name: 'Ordem Social (Art. 193 ao 232)', description: 'Seguridade Social: Sa√∫de, Previd√™ncia e Assist√™ncia. Educa√ß√£o, Cultura, Desporto, Comunica√ß√£o social, Meio ambiente. Fam√≠lia, crian√ßa, adolescente, idoso e √≠ndio.' },
                            { id: 'const-disposicoes-gerais-transitorias', name: 'Disposi√ß√µes Constitucionais Gerais e Transit√≥rias', description: 'Disposi√ß√µes Gerais. Atos das Disposi√ß√µes Constitucionais Transit√≥rias (ADCT). Princ√≠pios de hermen√™utica constitucional.' }
                        ]
                    },
                    {
                        name: "Direito Administrativo",
                        topics: [
                            { id: 'adm-conceito-fontes-principios', name: 'Conceito, fontes e princ√≠pios do Direito Administrativo', description: 'Defini√ß√£o do Direito Administrativo, suas fontes (lei, jurisprud√™ncia, doutrina, costumes) e princ√≠pios fundamentais (legalidade, impessoalidade, moralidade, publicidade, efici√™ncia, supremacia do interesse p√∫blico, indisponibilidade do interesse p√∫blico).' },
                            { id: 'adm-administracao-publica', name: 'Administra√ß√£o P√∫blica: direta e indireta', description: 'Estrutura da Administra√ß√£o P√∫blica, distinguindo a administra√ß√£o direta (√≥rg√£os) da indireta (autarquias, funda√ß√µes p√∫blicas, empresas p√∫blicas, sociedades de economia mista).' },
                            { id: 'adm-atos-administrativos-conceito-elementos-atributos-especies', name: 'Atos administrativos: Conceito, elementos, atributos, esp√©cies', description: 'Conceito de atos administrativos, seus elementos (compet√™ncia, finalidade, forma, motivo, objeto), atributos (presun√ß√£o de legitimidade, autoexecutoriedade, tipicidade, imperatividade) e esp√©cies (vinculados, discricion√°rios, negociais, enunciativos, punitivos).' },
                            { id: 'adm-atos-administrativos-revogacao-anulacao-convalidacao', name: 'Atos administrativos: Revoga√ß√£o, anula√ß√£o, convalida√ß√£o', description: 'Estudo dos modos de extin√ß√£o e saneamento dos atos administrativos: revoga√ß√£o (por conveni√™ncia e oportunidade), anula√ß√£o (por ilegalidade) e convalida√ß√£o (saneamento de v√≠cios).' },
                            { id: 'adm-poderes-administracao', name: 'Poderes da Administra√ß√£o: hier√°rquico, disciplinar, regulamentar, de pol√≠cia', description: 'An√°lise dos poderes administrativos: poder hier√°rquico (organiza√ß√£o interna e controle de subordina√ß√£o), poder disciplinar (aplica√ß√£o de san√ß√µes), poder regulamentar (expedi√ß√£o de normas gerais) e poder de pol√≠cia (limita√ß√£o e fiscaliza√ß√£o de atividades).' },
                            { id: 'adm-servicos-publicos', name: 'Servi√ßos p√∫blicos: princ√≠pios, formas de presta√ß√£o, delega√ß√£o', description: 'Conceito de servi√ßo p√∫blico, seus princ√≠pios (continuidade, generalidade, modicidade, seguran√ßa, atualidade) e formas de presta√ß√£o (direta, indireta por concess√£o, permiss√£o, autoriza√ß√£o).' },
                            { id: 'adm-licitacoes-contratos-lei-14133', name: 'Licita√ß√µes e contratos administrativos: Lei 14.133/2021', description: 'Regime jur√≠dico das licita√ß√µes e contratos administrativos, com foco na Nova Lei de Licita√ß√µes e Contratos (Lei n¬∫ 14.133/2021), seus princ√≠pios, modalidades e fases.' },
                            { id: 'adm-licitacoes-contratos-dispensa-inexigibilidade-fases', name: 'Licita√ß√µes e contratos administrativos: Dispensa, inexigibilidade, fases da licita√ß√£o', description: 'Estudo das hip√≥teses de dispensa e inexigibilidade de licita√ß√£o, e as fases da licita√ß√£o (preparat√≥ria, externa: divulga√ß√£o, apresenta√ß√£o de propostas, julgamento, habilita√ß√£o, adjudica√ß√£o, homologa√ß√£o).' },
                            { id: 'adm-licitacoes-contratos-caracteristicas', name: 'Licita√ß√µes e contratos administrativos: Caracter√≠sticas dos contratos administrativos', description: 'An√°lise das caracter√≠sticas dos contratos administrativos (cl√°usulas exorbitantes, mutabilidade, formalismo, consensualidade, onerosidade, comutatividade).' },
                            { id: 'adm-responsabilidade-civil-estado-teoria-risco', name: 'Responsabilidade civil do Estado: Teoria do risco administrativo', description: 'Estudo da teoria do risco administrativo como fundamento da responsabilidade objetiva do Estado, e a teoria do risco integral.' },
                            { id: 'adm-responsabilidade-civil-estado-omissao-excludentes', name: 'Responsabilidade civil do Estado: Omiss√£o e excludentes', description: 'An√°lise da responsabilidade do Estado por omiss√£o (subjetiva) e as excludentes de responsabilidade (culpa exclusiva da v√≠tima, caso fortuito, for√ßa maior).' },
                            { id: 'adm-servidores-publicos-regime-provimento-vacancia-estabilidade-penalidades', name: 'Servidores p√∫blicos: Regime jur√≠dico, provimento, vac√¢ncia, estabilidade, penalidades', description: 'Regime jur√≠dico dos servidores p√∫blicos, formas de provimento (nomea√ß√£o, promo√ß√£o, readapta√ß√£o, revers√£o, aproveitamento, reintegra√ß√£o, recondu√ß√£o) e vac√¢ncia (exonera√ß√£o, demiss√£o, aposentadoria, falecimento, posse em outro cargo inacumul√°vel). Estabilidade, direitos, deveres e penalidades disciplinares.' },
                            { id: 'adm-controle-administracao-interno-externo-judicial', name: 'Controle da Administra√ß√£o: Interno, externo, judicial', description: 'Mecanismos de controle interno (pela pr√≥pria administra√ß√£o), externo (pelo Legislativo com aux√≠lio dos Tribunais de Contas) e judicial (pelo Poder Judici√°rio) da Administra√ß√£o P√∫blica.' },
                            { id: 'adm-controle-administracao-tcu', name: 'Controle da Administra√ß√£o: TCU', description: 'O papel e as compet√™ncias do Tribunal de Contas da Uni√£o (TCU) na fiscaliza√ß√£o cont√°bil, financeira, or√ßament√°ria, operacional e patrimonial da Uni√£o.' },
                            { id: 'adm-improbidade-administrativa', name: 'Improbidade administrativa (Leis 8.429/92 e 14.230/21)', description: 'Estudo da Lei de Improbidade Administrativa (Lei n¬∫ 8.429/92), suas altera√ß√µes pela Lei n¬∫ 14.230/2021, atos de improbidade (enriquecimento il√≠cito, dano ao er√°rio, princ√≠pios) e san√ß√µes.' },
                            { id: 'adm-bens-publicos', name: 'Bens p√∫blicos', description: 'Classifica√ß√£o dos bens p√∫blicos (uso comum do povo, uso especial, dominicais), regime jur√≠dico, afeta√ß√£o e desafeta√ß√£o, formas de aquisi√ß√£o e aliena√ß√£o.' },
                            { id: 'adm-intervencao-propriedade', name: 'Interven√ß√£o na propriedade (desapropria√ß√£o, requisi√ß√£o)', description: 'Formas de interven√ß√£o do Estado na propriedade privada, como desapropria√ß√£o (por utilidade p√∫blica, necessidade p√∫blica, interesse social), requisi√ß√£o administrativa, servid√£o administrativa, tombamento e ocupa√ß√£o tempor√°ria.' },
                            { id: 'adm-concessao-permissao-autorizacao', name: 'Concess√£o, permiss√£o e autoriza√ß√£o', description: 'Diferencia√ß√£o entre concess√£o (contrato administrativo), permiss√£o (ato unilateral prec√°rio) e autoriza√ß√£o (ato unilateral discricion√°rio) de uso de bens p√∫blicos e de servi√ßos p√∫blicos.' },
                            { id: 'adm-agentes-publicos', name: 'Agentes p√∫blicos: esp√©cies, responsabilidades', description: 'Classifica√ß√£o dos agentes p√∫blicos (pol√≠ticos, administrativos, honor√≠ficos, delegados, credenciados) e suas responsabilidades (civil, penal, administrativa).' },
                            { id: 'adm-organizacao-centralizacao-descentralizacao', name: 'Organiza√ß√£o administrativa: centraliza√ß√£o e descentraliza√ß√£o', description: 'Conceitos de centraliza√ß√£o (execu√ß√£o direta pela pessoa jur√≠dica) e descentraliza√ß√£o (transfer√™ncia de compet√™ncias para outra pessoa jur√≠dica, por outorga ou delega√ß√£o), e desconcentra√ß√£o (distribui√ß√£o de compet√™ncias dentro da mesma pessoa jur√≠dica).' },
                            { id: 'adm-parcerias-publico-privadas', name: 'Parcerias p√∫blico-privadas (PPP)', description: 'Regime jur√≠dico das Parcerias P√∫blico-Privadas (Lei n¬∫ 11.079/2004), modalidades (patrocinada, administrativa) e caracter√≠sticas, distinguindo-as das concess√µes comuns.' }
                        ]
                    },
                    {
                        name: "Direito Civil",
                        topics: [
                            { id: 'civil-lei-introducao', name: 'Lei de Introdu√ß√£o √†s Normas do Direito Brasileiro (LINDB)', description: 'Vig√™ncia, aplica√ß√£o, interpreta√ß√£o e integra√ß√£o das normas.' },
                            { id: 'civil-pessoas', name: 'Pessoas Naturais e Jur√≠dicas', description: 'Capacidade, personalidade, domic√≠lio, bens, fatos jur√≠dicos.' },
                            { id: 'civil-bens', name: 'Bens', description: 'Classifica√ß√£o dos bens e sua import√¢ncia jur√≠dica.' },
                            { id: 'civil-fatos-atos-negocios', name: 'Fatos, Atos e Neg√≥cios Jur√≠dicos', description: 'Requisitos de validade, defeitos, nulidade e anulabilidade.' },
                            { id: 'civil-prescricao-decadencia', name: 'Prescri√ß√£o e Decad√™ncia', description: 'Conceitos, prazos e causas de interrup√ß√£o e suspens√£o.' },
                            { id: 'civil-obrigacoes', name: 'Direito das Obriga√ß√µes', description: 'Modalidades, transmiss√£o, adimplemento, inadimplemento.' },
                            { id: 'civil-contratos', name: 'Direito dos Contratos', description: 'Princ√≠pios, classifica√ß√£o, forma√ß√£o, v√≠cios redibit√≥rios, evic√ß√£o.' },
                            { id: 'civil-responsabilidade-civil', name: 'Responsabilidade Civil', description: 'Contratual e extracontratual, objetiva e subjetiva, dano moral e material.' },
                            { id: 'civil-familia', name: 'Direito de Fam√≠lia', description: 'Casamento, uni√£o est√°vel, div√≥rcio, alimentos, guarda.' },
                            { id: 'civil-sucessoes', name: 'Direito das Sucess√µes', description: 'Sucess√£o leg√≠tima e testament√°ria, invent√°rio e partilha.' },
                            { id: 'civil-reais', name: 'Direitos Reais', description: 'Propriedade, posse, usufruto, servid√£o.' }
                        ]
                    },
                    {
                        name: "Direito Penal",
                        topics: [
                            { id: 'penal-parte-geral', name: 'Parte Geral (Arts. 1¬∫ a 120 do CP)', description: 'Abrange os fundamentos do Direito Penal, como os princ√≠pios (legalidade, anterioridade da lei, insignific√¢ncia, lesividade, humanidade, culpabilidade), a aplica√ß√£o da lei penal no tempo e no espa√ßo (extraterritorialidade condicionada e incondicionada), a teoria do crime (fato t√≠pico, ilicitude, culpabilidade), o estudo do erro de tipo e erro de proibi√ß√£o, o concurso de pessoas (coautoria e participa√ß√£o), as esp√©cies de penas (privativas de liberdade, restritivas de direitos, multa), sua aplica√ß√£o, comina√ß√£o, substitui√ß√£o e suspens√£o condicional, o concurso de crimes (material, formal, continuidade delitiva), a prescri√ß√£o e outras causas de extin√ß√£o da punibilidade, as medidas de seguran√ßa e a imputabilidade penal.' },
                            { id: 'penal-principios', name: 'Princ√≠pios do Direito Penal (legalidade, anterioridade, insignific√¢ncia)', description: 'Detalhamento dos princ√≠pios fundamentais do Direito Penal: Princ√≠pio da Legalidade (nullum crimen, nulla poena sine praevia lege), Princ√≠pio da Anterioridade (irretroatividade da lei penal, salvo para beneficiar o r√©u), Princ√≠pio da Insignific√¢ncia (afasta a tipicidade material em casos de √≠nfima les√£o ao bem jur√≠dico), Princ√≠pio da Culpabilidade, Interven√ß√£o M√≠nima, Lesividade, Humanidade e Individualiza√ß√£o da Pena.' },
                            { id: 'penal-aplicacao-lei', name: 'Aplica√ß√£o da lei penal (tempo, espa√ßo, extraterritorialidade)', description: 'Estudo da aplica√ß√£o da lei penal no tempo (tempus regit actum, novatio legis in pejus, abolitio criminis) e no espa√ßo (territorialidade, extraterritorialidade incondicionada, condicionada e hipercondicionada, com foco nos artigos 5¬∫, 6¬∫ e 7¬∫ do C√≥digo Penal).' },
                            { id: 'penal-teoria-crime', name: 'Teoria do crime: fato t√≠pico, ilicitude, culpabilidade', description: 'An√°lise dos elementos do conceito anal√≠tico de crime: Fato T√≠pico (conduta, resultado, nexo causal, tipicidade), Ilicitude (antijuridicidade e suas excludentes, como leg√≠tima defesa, estado de necessidade, estrito cumprimento do dever legal e exerc√≠cio regular de direito), e Culpabilidade (imputabilidade, potencial consci√™ncia da ilicitude e exigibilidade de conduta diversa).' },
                            { id: 'penal-erro-tipo-proibicao', name: 'Erro de tipo e erro de proibi√ß√£o', description: 'Diferencia√ß√£o e consequ√™ncias do erro de tipo (erro sobre elemento do tipo penal, que pode ser essencial ou acidental, e que exclui o dolo ou a culpa, dependendo se √© escus√°vel ou inescus√°vel) e do erro de proibi√ß√£o (erro sobre a ilicitude do fato, que afeta a culpabilidade, podendo isentar ou diminuir a pena).' },
                            { id: 'penal-concurso-pessoas', name: 'Concurso de pessoas', description: 'Estudo das situa√ß√µes em que duas ou mais pessoas concorrem para a pr√°tica do mesmo crime, abordando a coautoria (execu√ß√£o conjunta) e a participa√ß√£o (induzimento, instiga√ß√£o, aux√≠lio), e a teoria monista (todos respondem pelo mesmo crime) e pluralista (crimes aut√¥nomos).' },
                            { id: 'penal-penas', name: 'Penas: esp√©cies, aplica√ß√£o, comina√ß√£o, substitui√ß√£o, suspens√£o condicional', description: 'An√°lise das penas privativas de liberdade (reclus√£o, deten√ß√£o, pris√£o simples), restritivas de direitos (presta√ß√£o de servi√ßos √† comunidade, interdi√ß√£o tempor√°ria de direitos, limita√ß√£o de fim de semana, etc.) e de multa. Estudo da dosimetria da pena (tr√™s fases), comina√ß√£o legal, substitui√ß√£o de penas privativas de liberdade por restritivas de direitos, e suspens√£o condicional da pena (sursis).' },
                            { id: 'penal-concurso-crimes', name: 'Concurso de crimes (formal, material, continuidade delitiva)', description: 'Estudo das formas de concurso de crimes: Concurso Material (pluralidade de condutas e crimes, somam-se as penas), Concurso Formal (uma s√≥ conduta, dois ou mais crimes, aplica-se a pena mais grave ou a aumentada), e Crime Continuado (crimes da mesma esp√©cie, nas mesmas condi√ß√µes de tempo, lugar e modo de execu√ß√£o, como continua√ß√£o do primeiro, aplica-se a pena de um s√≥ crime aumentada).' },
                            { id: 'penal-prescricao-extincao', name: 'Prescri√ß√£o e extin√ß√£o da punibilidade', description: 'Conceito de prescri√ß√£o (perda do direito de punir ou de executar a pena pelo decurso do tempo), suas modalidades (prescri√ß√£o da pretens√£o punitiva e prescri√ß√£o da pretens√£o execut√≥ria), e outras causas de extin√ß√£o da punibilidade (morte do agente, anistia, gra√ßa, indulto, peremp√ß√£o, perd√£o judicial, etc.), conforme o Art. 107 do CP.' },
                            { id: 'penal-medidas-seguranca', name: 'Medidas de seguran√ßa', description: 'San√ß√µes penais aplicadas a inimput√°veis ou semi-imput√°veis que praticam fatos t√≠picos e il√≠citos, mas n√£o s√£o culp√°veis. Foco na periculosidade do agente e na finalidade terap√™utica, com estudo das esp√©cies (interna√ß√£o, tratamento ambulatorial) e seu regime jur√≠dico.' },
                            { id: 'penal-imputabilidade', name: 'Imputabilidade penal', description: 'Capacidade de o agente entender o car√°ter il√≠cito do fato e de determinar-se de acordo com esse entendimento. Estudo das causas de inimputabilidade (doen√ßa mental, desenvolvimento mental incompleto ou retardado, menoridade) e semi-imputabilidade, e seus efeitos na culpabilidade e na aplica√ß√£o da pena.' },
                            { id: 'penal-crimes-contra-pessoa', name: 'Crimes contra a pessoa (homic√≠dio, les√£o corporal, aborto, honra etc.)', description: 'Estudo dos crimes contra a vida (homic√≠dio simples, qualificado, privilegiado, feminic√≠dio, infantic√≠dio, aborto), crimes de les√£o corporal (leve, grave, grav√≠ssima, seguida de morte), crimes contra a honra (cal√∫nia, difama√ß√£o, inj√∫ria) e outros crimes contra a pessoa previstos no C√≥digo Penal.' },
                            { id: 'penal-crimes-contra-patrimonio', name: 'Crimes contra o patrim√¥nio (furto, roubo, estelionato, recepta√ß√£o)', description: 'An√°lise dos crimes de furto (simples, qualificado), roubo (simples, qualificado, extors√£o mediante sequestro), extors√£o, estelionato (simples, qualificado, modalidades), apropria√ß√£o ind√©bita, recepta√ß√£o (simples, qualificada, culposa) e outros delitos que afetam o patrim√¥nio, com suas respectivas qualificadoras e causas de aumento de pena.' },
                            { id: 'penal-crimes-contra-fe-publica', name: 'Crimes contra a f√© p√∫blica (falsidade documental, moeda falsa)', description: 'Estudo dos crimes que atentam contra a confian√ßa que a sociedade deposita em certos documentos ou s√≠mbolos. Inclui falsifica√ß√£o de moeda, falsidade documental (p√∫blica e particular), falsidade ideol√≥gica, uso de documento falso, e outros crimes contra a f√© p√∫blica.' },
                            { id: 'penal-crimes-contra-adm-publica', name: 'Crimes contra a administra√ß√£o p√∫blica (peculato, corrup√ß√£o, prevarica√ß√£o)', description: 'An√°lise dos crimes praticados por funcion√°rios p√∫blicos contra a administra√ß√£o em geral (peculato, concuss√£o, corrup√ß√£o passiva, prevarica√ß√£o, condescend√™ncia criminosa, advocacia administrativa) e crimes praticados por particulares contra a administra√ß√£o em geral (desacato, desobedi√™ncia, corrup√ß√£o ativa, tr√°fico de influ√™ncia, etc.).' },
                            { id: 'penal-crimes-dignidade-sexual', name: 'Crimes contra a dignidade sexual (estupro, ass√©dio, importuna√ß√£o)', description: 'Estudo dos crimes que protegem a liberdade sexual e a dignidade da pessoa. Inclui estupro, estupro de vulner√°vel, ass√©dio sexual, importuna√ß√£o sexual, viola√ß√£o sexual mediante fraude, e outros crimes contra a dignidade sexual, com suas qualificadoras e causas de aumento de pena.' },
                            { id: 'penal-crimes-paz-publica-familia', name: 'Crimes contra a paz p√∫blica, a fam√≠lia e outros', description: 'Aborda crimes como associa√ß√£o criminosa, constitui√ß√£o de mil√≠cia privada, incita√ß√£o ao crime, apologia de crime ou criminoso (crimes contra a paz p√∫blica). Tamb√©m inclui crimes contra a fam√≠lia (bigamia, abandono de incapaz, etc.) e outros crimes relevantes previstos na Parte Especial do C√≥digo Penal.' }
                        ]
                    },
                    {
                        name: "Direito Processual Penal",
                        topics: [
                            { id: 'proc-penal-principios', name: 'Princ√≠pios do Processo Penal', description: 'Estudo dos princ√≠pios fundamentais que regem o processo penal, como o devido processo legal, contradit√≥rio, ampla defesa, presun√ß√£o de inoc√™ncia, publicidade, oralidade, identidade f√≠sica do juiz, livre convencimento motivado, e o princ√≠pio da verdade real.' },
                            { id: 'proc-penal-aplicacao-lei', name: 'Aplica√ß√£o da Lei Processual Penal', description: 'Regras de aplica√ß√£o da lei processual penal no tempo (princ√≠pio da imediatidade, atos processuais aut√¥nomos) e no espa√ßo (territorialidade, lex fori), e a interpreta√ß√£o da lei processual penal, incluindo as normas h√≠bridas.' },
                            { id: 'proc-penal-inquerito-policial', name: 'Inqu√©rito Policial', description: 'Conceito, natureza jur√≠dica (procedimento administrativo, inquisitivo), caracter√≠sticas (escrito, discricion√°rio, sigiloso, indispon√≠vel, oficial, oficioso), valor probat√≥rio (elementos informativos), formas de instaura√ß√£o, dilig√™ncias, indiciamento (ato privativo do delegado) e arquivamento.' },
                            { id: 'proc-penal-acao-penal', name: 'A√ß√£o Penal', description: 'Estudo da a√ß√£o penal, suas esp√©cies (p√∫blica incondicionada, p√∫blica condicionada √† representa√ß√£o ou requisi√ß√£o, e privada), condi√ß√µes da a√ß√£o (legitimidade, interesse de agir, justa causa), e a pe√ßa inicial (den√∫ncia ou queixa-crime).' },
                            { id: 'proc-penal-jurisdicao-competencia', name: 'Jurisdi√ß√£o e Compet√™ncia', description: 'Conceito de jurisdi√ß√£o (poder-dever de julgar) e compet√™ncia (limite da jurisdi√ß√£o), crit√©rios de fixa√ß√£o da compet√™ncia (territorial, material, funcional, em raz√£o da pessoa - ratione personae), preven√ß√£o, conex√£o e contin√™ncia. Aborda tamb√©m a compet√™ncia absoluta e relativa.' },
                            { id: 'proc-penal-sujeitos-processo', name: 'Sujeitos do Processo Penal', description: 'An√°lise dos principais sujeitos processuais: juiz (garantias e veda√ß√µes), Minist√©rio P√∫blico (titular da a√ß√£o penal p√∫blica, fiscal da lei), acusado (direitos e garantias, autodefesa), defensor (t√©cnico), querelante, assistente de acusa√ß√£o, e seus pap√©is no processo.' },
                            { id: 'proc-penal-atos-processuais', name: 'Atos Processuais', description: 'Estudo dos atos processuais, sua forma (escrita, oral), tempo e lugar de realiza√ß√£o, prazos processuais (pr√≥prios e impr√≥prios), e as nulidades processuais (absolutas, relativas, e o princ√≠pio do preju√≠zo - pas de nullit√© sans grief), seus efeitos e convalida√ß√£o.' },
                            { id: 'proc-penal-provas', name: 'Provas no Processo Penal', description: 'Sistema de avalia√ß√£o das provas (livre convencimento motivado, persuas√£o racional), prova il√≠cita (ilicitudes por deriva√ß√£o, fontes independentes, descoberta inevit√°vel), e os meios de prova (testemunhas, documentos, per√≠cia, interrogat√≥rio do acusado, confiss√£o, busca e apreens√£o, reconhecimento de pessoas e coisas, acarea√ß√£o, ind√≠cios).' },
                            { id: 'proc-penal-cadeia-custodia', name: 'Cadeia de Cust√≥dia', description: 'Conceito e import√¢ncia da cadeia de cust√≥dia para a preserva√ß√£o da integridade e autenticidade da prova pericial, desde o reconhecimento do vest√≠gio at√© o descarte. Aborda as etapas (reconhecimento, isolamento, fixa√ß√£o, coleta, acondicionamento, transporte, recebimento, processamento, armazenamento, descarte) e a quebra da cadeia.' },
                            { id: 'proc-penal-prisoes-medidas-cautelares', name: 'Pris√µes e Medidas Cautelares', description: 'Estudo da pris√£o em flagrante (modalidades, auto de pris√£o, relaxamento), pris√£o preventiva (requisitos, fundamentos, descumprimento de cautelares), pris√£o tempor√°ria (requisitos espec√≠ficos), e as diversas medidas cautelares diversas da pris√£o (art. 319 do CPP), liberdade provis√≥ria com ou sem fian√ßa.' },
                            { id: 'proc-penal-procedimentos-penais', name: 'Procedimentos Penais', description: 'An√°lise dos procedimentos comum (ordin√°rio, sum√°rio e sumar√≠ssimo - Juizados Especiais Criminais) e procedimentos especiais (Lei Maria da Penha, Lei de Drogas, Lei de Crimes Ambientais, Lei de Organiza√ß√µes Criminosas, Tribunal do J√∫ri), com foco nas suas particularidades e ritos.' },
                            { id: 'proc-penal-recursos', name: 'Recursos no Processo Penal', description: 'Estudo dos recursos cab√≠veis no processo penal: apela√ß√£o, recurso em sentido estrito (RESE), embargos de declara√ß√£o, embargos infringentes e de nulidade, carta testemunh√°vel, correi√ß√£o parcial, habeas corpus, revis√£o criminal, recurso extraordin√°rio e recurso especial. Abrange prazos, cabimento e efeitos.' },
                            { id: 'proc-penal-execucao-penal', name: 'Execu√ß√£o Penal (No√ß√µes B√°sicas)', description: 'No√ß√µes b√°sicas da Lei de Execu√ß√£o Penal (LEP - Lei n¬∫ 7.210/84), regimes de cumprimento de pena (fechado, semiaberto, aberto), progress√£o de regime, regress√£o de regime, livramento condicional, remi√ß√£o de pena, direitos e deveres do preso, e os incidentes da execu√ß√£o (falta grave, excesso ou desvio).' }
                        ]
                    },
                    {
                        name: "Direito do Trabalho",
                        topics: [
                            { id: 'trab-principios', name: 'Princ√≠pios do Direito do Trabalho', description: 'Prote√ß√£o, irrenunciabilidade, continuidade da rela√ß√£o de emprego.' },
                            { id: 'trab-fontes', name: 'Fontes do Direito do Trabalho', description: 'CLT, Constitui√ß√£o, conven√ß√µes e acordos coletivos.' },
                            { id: 'trab-contrato-trabalho', name: 'Contrato Individual de Trabalho', description: 'Conceito, requisitos, esp√©cies, altera√ß√£o, suspens√£o, interrup√ß√£o.' },
                            { id: 'trab-salario-remuneracao', name: 'Sal√°rio e Remunera√ß√£o', description: 'Conceito, distin√ß√£o, adicionais, equipara√ß√£o salarial.' },
                            { id: 'trab-jornada-trabalho', name: 'Jornada de Trabalho', description: 'Dura√ß√£o, horas extras, intervalos, trabalho noturno.' },
                            { id: 'trab-extincao-contrato', name: 'Extin√ß√£o do Contrato de Trabalho', description: 'Justa causa, sem justa causa, rescis√£o indireta, FGTS, seguro-desemprego.' },
                            { id: 'trab-direito-coletivo', name: 'Direito Coletivo do Trabalho', description: 'Organiza√ß√£o sindical, negocia√ß√£o coletiva, greve.' },
                            { id: 'trab-processo-trabalho', name: 'Processo do Trabalho', description: 'Compet√™ncia, rito, recursos, execu√ß√£o trabalhista.' }
                        ]
                    },
                    {
                        name: "Direito Previdenci√°rio",
                        topics: [
                            { id: 'prev-principios', name: 'Princ√≠pios do Direito Previdenci√°rio', description: 'Solidariedade, universalidade, seletividade, distributividade.' },
                            { id: 'prev-seguridade-social', name: 'Seguridade Social', description: 'Conceito, organiza√ß√£o, financiamento, sa√∫de, assist√™ncia, previd√™ncia.' },
                            { id: 'prev-beneficios', name: 'Benef√≠cios Previdenci√°rios', description: 'Aposentadorias, pens√£o por morte, aux√≠lios, sal√°rio-maternidade.' },
                            { id: 'prev-segurados', name: 'Segurados Obrigat√≥rios e Facultativos', description: 'Categorias de segurados e suas contribui√ß√µes.' },
                            { id: 'prev-carencia', name: 'Per√≠odo de Car√™ncia', description: 'Requisitos para concess√£o de benef√≠cios.' },
                            { id: 'prev-salario-contribuicao', name: 'Sal√°rio de Contribui√ß√£o', description: 'Base de c√°lculo, limites e reajustes.' },
                            { id: 'prev-recursos-administrativos', name: 'Recursos Administrativos Previdenci√°rios', description: 'Processo administrativo no INSS.' }
                        ]
                    },
                    {
                        name: "Direito Tribut√°rio",
                        topics: [
                            { id: 'trib-principios', name: 'Princ√≠pios do Direito Tribut√°rio', description: 'Legalidade, irretroatividade, anterioridade, capacidade contributiva.' },
                            { id: 'trib-tributos', name: 'Sistema Tribut√°rio Nacional', description: 'Impostos, taxas, contribui√ß√µes de melhoria, empr√©stimos compuls√≥rios.' },
                            { id: 'trib-competencia', name: 'Compet√™ncia Tribut√°ria', description: 'Uni√£o, Estados, Munic√≠pios, DF e suas atribui√ß√µes.' },
                            { id: 'trib-obrigacao-credito', name: 'Obriga√ß√£o Tribut√°ria e Cr√©dito Tribut√°rio', description: 'Fato gerador, sujeito ativo e passivo, lan√ßamento, suspens√£o, extin√ß√£o, exclus√£o.' },
                            { id: 'trib-impostos-especie', name: 'Impostos em Esp√©cie', description: 'IR, IPI, ICMS, ISS, IPTU, IPVA, ITBI, ITCMD.' },
                            { id: 'trib-execucao-fiscal', name: 'Execu√ß√£o Fiscal', description: 'Processo de cobran√ßa judicial de cr√©ditos tribut√°rios.' }
                        ]
                    },
                    {
                        name: "Direito Empresarial (ou Comercial)",
                        topics: [
                            { id: 'emp-empresa-empresario', name: 'Empresa e Empres√°rio', description: 'Conceito, caracteriza√ß√£o, registro, empres√°rio individual.' },
                            { id: 'emp-sociedades', name: 'Direito Societ√°rio', description: 'Tipos de sociedades, constitui√ß√£o, dissolu√ß√£o, responsabilidade dos s√≥cios.' },
                            { id: 'emp-titulos-credito', name: 'T√≠tulos de Cr√©dito', description: 'Cheque, nota promiss√≥ria, duplicata, letra de c√¢mbio.' },
                            { id: 'emp-falencia-recuperacao', name: 'Fal√™ncia e Recupera√ß√£o de Empresas', description: 'Pressupostos, fases, efeitos, plano de recupera√ß√£o.' },
                            { id: 'emp-contratos-mercantis', name: 'Contratos Mercantis', description: 'Compra e venda mercantil, factoring, franquia, leasing.' },
                            { id: 'emp-propriedade-industrial', name: 'Propriedade Industrial', description: 'Patentes, marcas, desenhos industriais, indica√ß√µes geogr√°ficas.' }
                        ]
                    },
                    {
                        name: "Direito Ambiental",
                        topics: [
                            { id: 'amb-principios', name: 'Princ√≠pios do Direito Ambiental', description: 'Preven√ß√£o, precau√ß√£o, poluidor-pagador, desenvolvimento sustent√°vel.' },
                            { id: 'amb-sisnama', name: 'Pol√≠tica Nacional do Meio Ambiente (PNMA) e SISNAMA', description: 'Objetivos, instrumentos, √≥rg√£os.' },
                            { id: 'amb-licenciamento', name: 'Licenciamento Ambiental', description: 'Conceito, fases, EIA/RIMA.' },
                            { id: 'amb-responsabilidade', name: 'Responsabilidade Ambiental', description: 'Civil, penal e administrativa, solidariedade, objetividade.' },
                            { id: 'amb-unidades-conservacao', name: 'Unidades de Conserva√ß√£o', description: 'Classifica√ß√£o, categorias, cria√ß√£o, gest√£o.' },
                            { id: 'amb-recursos-hidricos', name: 'Recursos H√≠dricos', description: 'Pol√≠tica Nacional de Recursos H√≠dricos, uso, outorga.' },
                            { id: 'amb-florestal', name: 'Legisla√ß√£o Florestal (C√≥digo Florestal)', description: '√Åreas de Preserva√ß√£o Permanente (APP), Reserva Legal (RL).' }
                        ]
                    },
                    {
                        name: "Direito Internacional P√∫blico",
                        topics: [
                            { id: 'int-pub-fontes', name: 'Fontes do Direito Internacional P√∫blico', description: 'Tratados, costume, princ√≠pios gerais, jurisprud√™ncia.' },
                            { id: 'int-pub-sujeitos', name: 'Sujeitos de Direito Internacional P√∫blico', description: 'Estados, organiza√ß√µes internacionais, indiv√≠duos.' },
                            { id: 'int-pub-tratados', name: 'Tratados Internacionais', description: 'Conceito, classifica√ß√£o, forma√ß√£o, efeitos, extin√ß√£o.' },
                            { id: 'int-pub-solucao-controversias', name: 'Solu√ß√£o Pac√≠fica de Controv√©rsias', description: 'Negocia√ß√£o, media√ß√£o, arbitragem, Corte Internacional de Justi√ßa.' },
                            { id: 'int-pub-dir-humanos', name: 'Direito Internacional dos Direitos Humanos', description: 'Sistemas de prote√ß√£o, tratados, cortes (CIDH).' },
                            { id: 'int-pub-dir-conflitos-armados', name: 'Direito Internacional dos Conflitos Armados (Direito Humanit√°rio)', description: 'Regras de conduta em guerra, prote√ß√£o de v√≠timas.' }
                        ]
                    },
                    {
                        name: "Direito Internacional Privado",
                        topics: [
                            { id: 'int-priv-principios', name: 'Princ√≠pios do Direito Internacional Privado', description: 'Autonomia da vontade, lex fori, locus regit actum.' },
                            { id: 'int-priv-fontes', name: 'Fontes do Direito Internacional Privado', description: 'Lei de Introdu√ß√£o √†s Normas do Direito Brasileiro (LINDB), tratados.' },
                            { id: 'int-priv-competencia-internacional', name: 'Compet√™ncia Internacional', description: 'Jurisdi√ß√£o brasileira, litispend√™ncia, conex√£o.' },
                            { id: 'int-priv-lei-aplicavel', name: 'Lei Aplic√°vel', description: 'Conflito de leis, qualifica√ß√£o, reenvio.' },
                            { id: 'int-priv-condicao-juridica-estrangeiro', name: 'Condi√ß√£o Jur√≠dica do Estrangeiro no Brasil', description: 'Direitos, deveres, naturaliza√ß√£o, extradi√ß√£o.' },
                            { id: 'int-priv-homologacao-sentenca', name: 'Homologa√ß√£o de Senten√ßa Estrangeira', description: 'Requisitos, procedimento, efeitos.' }
                        ]
                    },
                    {
                        name: "Direito Eleitoral",
                        topics: [
                            { id: 'eleit-principios', name: 'Soberania popular, voto direto, secreto, universal e peri√≥dico.' },
                            { id: 'eleit-justica-eleitoral', name: 'Organiza√ß√£o da Justi√ßa Eleitoral', description: 'TSE, TREs, Ju√≠zes Eleitorais, Juntas Eleitorais.' },
                            { id: 'eleit-alistamento-eleitoral', name: 'Alistamento Eleitoral e Domic√≠lio Eleitoral', description: 'Capacidade eleitoral ativa e passiva.' },
                            { id: 'eleit-elegibilidade-inelegibilidade', name: 'Elegibilidade e Inelegibilidade', description: 'Condi√ß√µes e causas de inelegibilidade.' },
                            { id: 'eleit-partidos-politicos', name: 'Partidos Pol√≠ticos', description: 'Cria√ß√£o, registro, funcionamento, fidelidade partid√°ria.' },
                            { id: 'eleit-propaganda-eleitoral', name: 'Propaganda Eleitoral', description: 'Regras, limites, il√≠citos eleitorais.' },
                            { id: 'eleit-financiamento-campanhas', name: 'Financiamento de Campanhas Eleitorais', description: 'Fontes, limites, presta√ß√£o de contas.' },
                            { id: 'eleit-crimes-eleitorais', name: 'Crimes Eleitorais', description: 'Principais tipos e san√ß√µes.' },
                            { id: 'eleit-acao-impugnacao', name: 'A√ß√µes Eleitorais (AIME, AIJE, RCED, Representa√ß√£o)', description: 'Finalidade e procedimento de cada a√ß√£o.' }
                        ]
                    },
                    {
                        name: "Direito Digital",
                        topics: [
                            { id: 'dig-principios', name: 'Privacidade, seguran√ßa, neutralidade de rede, prote√ß√£o de dados.' },
                            { id: 'dig-marco-civil', name: 'Marco Civil da Internet (Lei 12.965/14)', description: 'Direitos e deveres na internet, provedores.' },
                            { id: 'dig-lgpd', name: 'Lei Geral de Prote√ß√£o de Dados (LGPD - Lei 13.709/18)', description: 'Tratamento de dados pessoais, direitos dos titulares, ANPD.' },
                            { id: 'dig-crimes-ciberneticos', name: 'Crimes Cibern√©ticos', description: 'Invas√£o de dispositivo, interrup√ß√£o de servi√ßo, falsidade ideol√≥gica.' },
                            { id: 'dig-contratos-eletronicos', name: 'Contratos Eletr√¥nicos', description: 'Validade, assinatura digital, prova.' },
                            { id: 'dig-comercio-eletronico', name: 'Com√©rcio Eletr√¥nico', description: 'Direitos do consumidor, seguran√ßa nas transa√ß√µes.' },
                            { id: 'dig-propriedade-intelectual', name: 'Propriedade Intelectual no Ambiente Digital', description: 'Direitos autorais, softwares, pirataria.' }
                        ]
                    },
                    {
                        name: "Direitos Humanos",
                        topics: [
                            { id: 'dh-conceito-geracoes', name: 'Conceito e Gera√ß√µes de Direitos Humanos', description: 'Evolu√ß√£o hist√≥rica, caracter√≠sticas e dimens√µes.' },
                            { id: 'dh-declaracao-universal', name: 'Declara√ß√£o Universal dos Direitos Humanos (DUDH)', description: 'Conte√∫do e import√¢ncia.' },
                            { id: 'dh-tratados-internacionais', name: 'Tratados Internacionais de Direitos Humanos', description: 'Pacta de direitos civis e pol√≠ticos, direitos econ√¥micos, sociais e culturais.' },
                            { id: 'dh-sistemas-protecao', name: 'Sistemas de Prote√ß√£o dos Direitos Humanos', description: 'Sistema global (ONU) e sistemas regionais (OEA, UE).' },
                            { id: 'dh-direitos-humanos-brasil', name: 'Direitos Humanos na Constitui√ß√£o Federal', description: 'Art. 5¬∫ e sua aplicabilidade.' },
                            { id: 'dh-violacao-responsabilidade', name: 'Viola√ß√£o de Direitos Humanos e Responsabilidade', description: 'Crimes contra a humanidade, genoc√≠dio, tortura.' }
                        ]
                    }
                ]
            },
            {
                category: "No√ß√µes de Inform√°tica",
                levels: ["informatica"],
                subCategories: [
                    {
                        name: "Conte√∫do Completo para Concursos",
                        topics: [
                            { id: 'conceitos-basicos-informatica', name: 'Conceitos B√°sicos de Inform√°tica', description: 'Fundamentos essenciais da computa√ß√£o, hardware, software, e sistemas de informa√ß√£o, relevantes para quest√µes de concursos FCC, FGV e Cebraspe.' },
                            { id: 'hardware', name: 'Hardware', description: 'Componentes f√≠sicos do computador (CPU, mem√≥ria, armazenamento, perif√©ricos), suas fun√ß√µes e caracter√≠sticas, frequentemente abordados em provas de inform√°tica.' },
                            { id: 'software', name: 'Software', description: 'Tipos de software (sistema, aplicativo, utilit√°rio), suas funcionalidades e licenciamento, com foco na aplicabilidade em cen√°rios de concurso.' },
                            { id: 'sistemas-operacionais', name: 'Sistemas Operacionais (Windows, Linux)', description: 'Princ√≠pios e funcionalidades de sistemas operacionais, com √™nfase em Windows e Linux, conforme exigido por bancas como Cebraspe.' },
                            { id: 'windows-10', name: 'Windows 10', description: 'Recursos, interface, gerenciamento de arquivos e configura√ß√µes do Windows 10, t√≥pico comum em quest√µes de inform√°tica para concursos.' },
                            { id: 'windows-11', name: 'Windows 11', description: 'Novas funcionalidades, interface e compatibilidade do Windows 11, considerando sua crescente relev√¢ncia em editais.' },
                            { id: 'organizacao-gerenciamento-arquivos', name: 'Conceitos de Organiza√ß√£o e de Gerenciamento de Arquivos', description: 'Estrutura de pastas, c√≥pia, movimenta√ß√£o, exclus√£o e busca de arquivos, fundamental para provas pr√°ticas e te√≥ricas.' },
                            { id: 'tipos-arquivos-extensoes', name: 'Tipos de Arquivos e Extens√µes', description: 'Identifica√ß√£o e funcionalidade de diferentes formatos de arquivo e suas extens√µes, frequentemente cobrado em quest√µes objetivas.' },
                            { id: 'atalhos-teclado', name: 'Atalhos de Teclado', description: 'Principais atalhos de teclado para sistemas operacionais e aplicativos, visando otimiza√ß√£o e agilidade, ponto comum em bancas como FCC.' },
                            { id: 'microsoft-office', name: 'Pacote Microsoft Office (Word, Excel, PowerPoint, Outlook)', description: 'Uso avan√ßado e recursos espec√≠ficos dos aplicativos Word, Excel, PowerPoint e Outlook, com quest√µes focadas em funcionalidades e atalhos.' },
                            { id: 'libreoffice', name: 'LibreOffice (Writer, Calc, Impress)', description: 'Funcionalidades equivalentes do LibreOffice (Writer, Calc, Impress), importante para concursos que abrangem software livre.' },
                            { id: 'internet-navegadores', name: 'Internet: Conceitos e Navegadores (Chrome, Firefox, Edge)', description: 'Fundamentos da internet, protocolos, e recursos de navegadores web, incluindo Chrome, Firefox e Edge, para quest√µes de navega√ß√£o e seguran√ßa.' },
                            { id: 'ferramentas-busca', name: 'Ferramentas e Aplicativos de Navega√ß√£o e Busca (Google, Bing)', description: 'Uso eficiente de motores de busca e ferramentas de pesquisa, com foco em estrat√©gias de busca e avalia√ß√£o de resultados.' },
                            { id: 'correio-eletronico', name: 'Correio Eletr√¥nico (e-mail): Uso, Seguran√ßa e Etiqueta', description: 'Funcionamento do e-mail, clientes de e-mail, seguran√ßa (spam, phishing) e boas pr√°ticas de comunica√ß√£o, tema recorrente em provas.' },
                            { id: 'armazenamento-nuvem', name: 'Armazenamento em Nuvem (Google Drive, OneDrive, Dropbox)', description: 'Conceitos de cloud storage, sincroniza√ß√£o, compartilhamento e seguran√ßa em plataformas como Google Drive, OneDrive e Dropbox.' },
                            { id: 'redes-computadores', name: 'Redes de Computadores: Conceitos B√°sicos', description: 'Fundamentos de redes (cliente-servidor, peer-to-peer), topologias e componentes, essenciais para entender a conectividade.' },
                            { id: 'tipos-redes', name: 'Tipos de Redes (LAN, WAN, MAN, PAN)', description: 'Classifica√ß√£o de redes por abrang√™ncia geogr√°fica e suas caracter√≠sticas, com quest√µes sobre cen√°rios de aplica√ß√£o.' },
                            { id: 'topologias-redes', name: 'Topologias de Redes (barramento, estrela, anel, malha, h√≠brida)', description: 'Estruturas f√≠sicas e l√≥gicas de redes, suas vantagens e desvantagens, frequentemente cobradas em quest√µes de redes.' },
                            { id: 'equipamentos-rede', name: 'Equipamentos de Rede (switch, roteador, hub, modem, access point)', description: 'Fun√ß√£o e aplica√ß√£o de dispositivos de rede, como switches, roteadores e modems, em diferentes arquiteturas.' },
                            { id: 'enderecamento-ip', name: 'Endere√ßamento IP (IPv4 e IPv6)', description: 'Estrutura e funcionamento dos endere√ßos IP (IPv4 e IPv6), classes de IP, e a transi√ß√£o entre as vers√µes.' },
                            { id: 'mascara-sub-rede', name: 'M√°scara de Sub-rede', description: 'C√°lculo e aplica√ß√£o de m√°scaras de sub-rede para divis√£o de redes, um t√≥pico mais t√©cnico, mas presente em provas avan√ßadas.' },
                            { id: 'dhcp-dns-nat', name: 'DHCP, DNS e NAT', description: 'Protocolos e servi√ßos de rede (DHCP para atribui√ß√£o de IP, DNS para resolu√ß√£o de nomes, NAT para tradu√ß√£o de endere√ßos), suas fun√ß√µes e import√¢ncia.' },
                            { id: 'protocolos-comunicacao', name: 'Protocolos de Comunica√ß√£o (TCP/IP, HTTP, HTTPS, FTP, SMTP, POP3, IMAP)', description: 'Principais protocolos de rede e suas aplica√ß√µes (navega√ß√£o, transfer√™ncia de arquivos, e-mail), com foco em seguran√ßa (HTTPS).' },
                            { id: 'intranet-extranet', name: 'Intranet e Extranet', description: 'Diferen√ßas e aplica√ß√µes de redes corporativas internas (Intranet) e externas (Extranet), e seus usos em organiza√ß√µes.' },
                            { id: 'compartilhamento-arquivos-impressoras', name: 'Compartilhamento de Arquivos e Impressoras em Rede', description: 'Configura√ß√£o e seguran√ßa para compartilhamento de recursos em ambientes de rede, com quest√µes sobre permiss√µes e acesso.' },
                            { id: 'seguranca-redes', name: 'Seguran√ßa em Redes (firewall, criptografia, VPN)', description: 'Conceitos e ferramentas de seguran√ßa de rede (firewall, VPN, criptografia), essenciais para proteger dados e sistemas.' },
                            { id: 'wi-fi', name: 'Wi-Fi: Configura√ß√µes, Seguran√ßa e Padr√µes (802.11a/b/g/n/ac/ax)', description: 'Tecnologias de rede sem fio, padr√µes Wi-Fi, configura√ß√µes de seguran√ßa (WPA2, WPA3) e otimiza√ß√£o de conex√£o.' },
                            { id: 'cabeamento-estruturado', name: 'Cabeamento Estruturado', description: 'Padr√µes e componentes de infraestrutura de cabeamento para redes, incluindo tipos de cabos e conectores.' },
                            { id: 'testes-conectividade', name: 'Testes de Conectividade (ping, tracert, ipconfig, nslookup)', description: 'Comandos e ferramentas para diagn√≥stico de rede, como ping, tracert, ipconfig e nslookup, para identificar problemas de conex√£o.' },
                            { id: 'internet-coisas', name: 'Conceitos de Internet das Coisas (IoT)', description: 'Fundamentos da IoT, dispositivos conectados, aplica√ß√µes e desafios de seguran√ßa e privacidade.' },
                            { id: 'computacao-nuvem', name: 'Computa√ß√£o em Nuvem (Cloud Computing)', description: 'Modelos de servi√ßo (IaaS, PaaS, SaaS), implanta√ß√£o (p√∫blica, privada, h√≠brida) e vantagens da computa√ß√£o em nuvem.' },
                            { id: 'navegacao-segura', name: 'Navega√ß√£o Segura, Certificados Digitais e Criptografia', description: 'Pr√°ticas de seguran√ßa online, uso de certificados digitais para autentica√ß√£o e criptografia para prote√ß√£o de dados.' },
                            { id: 'backup-recuperacao', name: 'Backup e Recupera√ß√£o de Dados em Rede', description: 'Estrat√©gias de backup (completo, incremental, diferencial), armazenamento e planos de recupera√ß√£o de desastres em ambientes de rede.' },
                            { id: 'boas-praticas-seguranca', name: 'Boas Pr√°ticas de Seguran√ßa Digital', description: 'Medidas preventivas e comportamentos seguros para proteger informa√ß√µes e sistemas contra amea√ßas cibern√©ticas.' },
                            { id: 'videoconferencia', name: 'Aplicativos de Videoconfer√™ncia (Zoom, Teams, Meet)', description: 'Funcionalidades e uso de plataformas de videoconfer√™ncia, com foco em recursos de colabora√ß√£o e seguran√ßa.' },
                            { id: 'dispositivos-moveis-redes-sem-fio', name: 'Dispositivos M√≥veis e Redes Sem Fio', description: 'Conectividade, seguran√ßa e gerenciamento de smartphones, tablets e outros dispositivos m√≥veis em redes sem fio.' },
                            { id: 'ferramentas-produtividade-colaboracao', name: 'Ferramentas de Produtividade e Colabora√ß√£o Online', description: 'Uso de ferramentas para trabalho em equipe, edi√ß√£o colaborativa e comunica√ß√£o em tempo real.' },
                            { id: 'softwares-utilitarios', name: 'Softwares Utilitarios e Ferramentas do Sistema', description: 'Fun√ß√µes de utilit√°rios (compactadores, antiv√≠rus) e ferramentas de sistema (gerenciador de tarefas, desfragmentador) para manuten√ß√£o.' },
                            { id: 'etica-legislacao-informatica', name: 'No√ß√µes de √âtica e Legisla√ß√£o em Inform√°tica (LGPD, Crimes Digitais)', description: 'Aspectos legais e √©ticos do uso da tecnologia, incluindo a Lei Geral de Prote√ß√£o de Dados (LGPD) e crimes cibern√©ticos.' }
                        ]
                    }
                ]
            }
        ];
        
        const educationalLaws = [
            { id: 'ldb', name: 'LDB - Lei de Diretrizes e Bases da Educa√ß√£o Nacional (Lei n¬∫ 9.394/96)', hasQuestions: true },
            { id: 'pne', name: 'PNE - Plano Nacional de Educa√ß√£o (Lei n¬∫ 13.005/14)', hasQuestions: true },
            { id: 'bncc', name: 'BNCC - Base Nacional Comum Curricular', hasQuestions: true },
            { id: 'eca', name: 'ECA - Estatuto da Crian√ßa e do Adolescente (Lei n¬∫ 8.069/90)', hasQuestions: true },
            { id: 'lei-inclusao', name: 'Lei Brasileira de Inclus√£o da Pessoa com Defici√™ncia (Lei n¬∫ 13.146/15)', hasQuestions: true },
            { id: 'lei-libras', name: 'Lei de Libras (Lei n¬∫ 10.436/02)', hasQuestions: true },
            { id: 'lei-historia-afro', name: 'Lei n¬∫ 10.639/03 - Hist√≥ria e Cultura Afro-Brasileira e Africana', hasQuestions: true }
        ];

        function showScreen(screenToShow) {
            [homeScreen, topicSelectionScreen, simuladoSetupScreen, quizScreen, finalScreen, essayCorrectionScreen, lawsScreen].forEach(screen => {
                screen.classList.add('hidden');
            });
            if (screenToShow) {
                screenToShow.classList.remove('hidden');
            }
        }

        function openModal(modalElement) {
            modalElement.classList.remove('hidden');
            setTimeout(() => {
                modalElement.classList.remove('opacity-0');
                if (modalElement.querySelector('.modal-container')) {
                    modalElement.querySelector('.modal-container').classList.remove('opacity-0', 'scale-95');
                }
            }, 10);
        }

        function closeModal(modalElement) {
            modalElement.classList.add('opacity-0');
            if (modalElement.querySelector('.modal-container')) {
                modalElement.querySelector('.modal-container').classList.add('opacity-0', 'scale-95');
            }
            setTimeout(() => {
                modalElement.classList.add('hidden');
            }, 300);
        }

        function updateStartButtonState(buttonElement) {
            const hasSelectedTopics = selectedTopics.length > 0;
            const hasValidQuestionQuantity = questionQuantity !== null && !isNaN(questionQuantity) && questionQuantity > 0;
            const isSimuladoReady = hasSelectedTopics && hasValidQuestionQuantity && difficulty !== null && responseMode !== null;

            if (isSimuladoReady) {
                buttonElement.disabled = false;
                buttonElement.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                buttonElement.disabled = true;
                buttonElement.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        function renderTopics(searchTerm = '') {
            const container = topicContainerSimulado;
            container.innerHTML = '';
            const lowerCaseSearchTerm = searchTerm.toLowerCase();

            const categoriesForCurrentLevel = grammarData.filter(category => category.levels.includes(currentLevel));

            categoriesForCurrentLevel.forEach(category => {
                if (category.subCategories) {
                    const filteredSubCategories = subCategory => {
                        const filteredTopics = subCategory.topics.filter(topic =>
                            topic.name.toLowerCase().includes(lowerCaseSearchTerm)
                        );
                        // Only show subcategory if it has matching topics OR if its name matches the search term
                        return filteredTopics.length > 0 || subCategory.name.toLowerCase().includes(lowerCaseSearchTerm);
                    };

                    category.subCategories.filter(filteredSubCategories).forEach(subCategory => {
                        const subCategoryDiv = document.createElement('div');
                        subCategoryDiv.className = 'bg-white p-6 rounded-xl shadow-md topic-card';
                        subCategoryDiv.innerHTML = `
                            <h3 class="text-xl font-bold text-sky-700 mb-4">${category.category} - ${subCategory.name}</h3>
                            <div class="topic-list-grid grid grid-cols-1 md:grid-cols-2 gap-3">
                                ${subCategory.topics.filter(topic =>
                                    topic.name.toLowerCase().includes(lowerCaseSearchTerm)
                                ).map(topic => `
                                    <label class="flex items-center p-3 border border-slate-300 rounded-lg cursor-pointer hover:bg-slate-50 transition-colors">
                                        <input type="checkbox" data-topic-id="${topic.id}" data-topic-name="${topic.name}" class="topic-checkbox w-5 h-5 text-blue-600 rounded focus:ring-blue-500 mr-3">
                                        <span class="text-slate-700 font-medium">${topic.name}</span>
                                        <div class="ml-auto flex gap-2">
                                            <button type="button" class="study-button flex items-center" data-topic-id="${topic.id}" data-topic-name="${topic.name}" title="Estudar este t√≥pico">
                                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                                                <span>Estudar</span>
                                            </button>
                                        </div>
                                    </label>
                                `).join('')}
                            </div>
                        `;
                        container.appendChild(subCategoryDiv);
                    });
                }
            });

            container.querySelectorAll('.topic-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (event) => {
                    const topicId = event.target.dataset.topicId;
                    const topicName = event.target.dataset.topicName;
                    if (event.target.checked) {
                        selectedTopics.push({ id: topicId, name: topicName });
                    } else {
                        selectedTopics = selectedTopics.filter(topic => topic.id !== topicId);
                    }
                    updateStartButtonState(startSimuladoButton);
                });
            });

            container.querySelectorAll('.study-button').forEach(button => {
                button.addEventListener('click', (event) => {
                    const topicId = event.currentTarget.dataset.topicId;
                    const topicName = event.currentTarget.dataset.topicName;
                    openStudyModal(topicId, topicName, 'Estudar:');
                });
            });
        }
        
        function renderLawsList() {
            const container = document.getElementById('laws-list-container');
            container.innerHTML = '';
            educationalLaws.forEach(law => {
                const lawDiv = document.createElement('div');
                lawDiv.className = 'w-full text-left p-4 bg-white rounded-lg shadow-md hover:bg-slate-50 transition-colors border-l-4 border-indigo-500 flex flex-col sm:flex-row justify-between items-start sm:items-center';
                lawDiv.innerHTML = `
                    <span class="text-slate-700 font-medium mb-2 sm:mb-0">${law.name}</span>
                    <div class="flex flex-wrap gap-2">
                        <button type="button" class="study-button flex items-center" data-law-id="${law.id}" data-law-name="${law.name}" title="Consultar este documento">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                            <span>Consultar</span>
                        </button>
                        ${law.hasQuestions ? `
                        <button type="button" class="study-button flex items-center" data-law-id="${law.id}" data-law-name="${law.name}" title="Praticar quest√µes sobre este documento">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                            </svg>
                            <span>Praticar</span>
                        </button>` : ''}
                    </div>
                `;
                container.appendChild(lawDiv);
            });

            container.querySelectorAll('.study-button').forEach(button => {
                button.addEventListener('click', (event) => {
                    const lawId = event.currentTarget.dataset.lawId;
                    const lawName = event.currentTarget.dataset.lawName;
                    openStudyModal(lawId, lawName, 'Consultar:');
                });
            });
        }

        async function callGeminiAPI(prompt, isJson = false, schema = null, maxRetries = 3, retryDelayMs = 1000) {
            const apiKey = "AIzaSyBZCyIRijGQHupvVA6aPfhS65DFjFHOmFQ"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: {}
            };

            if (isJson) {
                payload.generationConfig.responseMimeType = "application/json";
                if (schema) {
                    payload.generationConfig.responseSchema = schema;
                }
            }

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 503 && i < maxRetries - 1) {
                        console.warn(`API Gemini retornou 503. Tentando novamente em ${retryDelayMs / 1000} segundos... (Tentativa ${i + 1} de ${maxRetries})`);
                        await new Promise(resolve => setTimeout(resolve, retryDelayMs));
                        continue; // Retry the request
                    }

                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        return isJson ? JSON.parse(text) : text;
                    } else {
                        console.error("Resposta inesperada da API Gemini:", result);
                        throw new Error("A API n√£o retornou um resultado v√°lido.");
                    }
                } catch (error) {
                    console.error("Erro ao chamar a API Gemini:", error);
                    if (i < maxRetries - 1) {
                        console.warn(`Erro na API Gemini. Tentando novamente em ${retryDelayMs / 1000} segundos... (Tentativa ${i + 1} de ${maxRetries})`);
                    } else {
                        throw error; // Re-throw the error if max retries reached
                    }
                }
            }
            throw new Error("Falha ao chamar a API Gemini ap√≥s v√°rias tentativas.");
        }

        function applyStudyTextStyling(text) {
            // Replace custom tags with styled HTML spans
            let styledText = text.replace(/<highlight-term>(.*?)<\/highlight-term>/g, '<span class="highlight-term">$1</span>');
            styledText = styledText.replace(/<underline-text>(.*?)<\/underline-text>/g, '<span class="underline-text">$1</span>');
            styledText = styledText.replace(/<important-phrase>(.*?)<\/important-phrase>/g, '<span class="important-phrase">$1</span>');
            return styledText;
        }

        async function openStudyModal(topicId, topicName, modalTitlePrefix) {
            studyModalTitleText.textContent = `${modalTitlePrefix} ${topicName}`;
            studyText.innerHTML = '';
            studyText.classList.add('hidden');
            studyLoadingArea.classList.remove('hidden'); // Show spinner immediately
            openModal(studyModal);

            try {
                let prompt = '';
                const isLaw = educationalLaws.some(law => law.id === topicId);
                let subjectName = "";

                if (currentLevel === 'informatica') {
                    subjectName = "No√ß√µes de Inform√°tica";
                    // Enhanced prompt for "No√ß√µes de Inform√°tica"
                    prompt = `Gere um material de estudo **muito detalhado, aprofundado, abrangente e did√°tico** sobre o t√≥pico de ${subjectName} "${topicName}" para o n√≠vel de concurso p√∫blico. Inclua **todos os conceitos essenciais, exemplos pr√°ticos, e a relev√¢ncia para quest√µes de concursos das bancas FCC, FGV e Cebraspe**. Aborde o assunto de forma completa, com t√≠tulos e subt√≠tulos em Markdown. Para termos chave, use a tag HTML <highlight-term>termo</highlight-term>. Para sublinhar, use <underline-text>texto a sublinhar</underline-text>. Para destacar frases importantes, use <important-phrase>frase importante</important-phrase>.`;
                } else if (isLaw) {
                    subjectName = "Legisla√ß√£o Educacional";
                    prompt = `Gere um resumo completo e os pontos mais importantes do seguinte documento: "${topicName}". Organize o conte√∫do de forma clara e did√°tica, usando t√≠tulos e subt√≠tulos em Markdown. Para termos chave, use a tag HTML <highlight-term>termo</highlight-term>. Para sublinhar, use <underline-text>texto a sublinhar</underline-text>. Para destacar frases importantes, use <important-phrase>frase importante</important-phrase>.`;
                } else {
                    for (const cat of grammarData) {
                        if (cat.subCategories?.some(subCat => subCat.topics.some(t => t.id === topicId))) {
                            subjectName = cat.category;
                            break;
                        }
                    }
                    prompt = `Gere um material de estudo detalhado e did√°tico sobre o t√≥pico de ${subjectName} "${topicName}" para o n√≠vel de concurso p√∫blico. Inclua exemplos claros e, se poss√≠vel, um pequeno exerc√≠cio com gabarito. Formate a resposta usando Markdown. Para termos chave, use a tag HTML <highlight-term>termo</highlight-term>. Para sublinhar, use <underline-text>texto a sublinhar</underline-text>. Para destacar frases importantes, use <important-phrase>frase importante</important-phrase>.`;
                }
                
                const markdownText = await callGeminiAPI(prompt);
                const styledHtml = applyStudyTextStyling(marked.parse(markdownText));
                studyText.innerHTML = styledHtml;
                studyText.classList.remove('hidden');
            } catch (error) {
                console.error(`Erro ao carregar material de estudo para ${topicName}:`, error);
                studyText.textContent = 'Ocorreu um erro ao carregar o material de estudo.';
                studyText.classList.remove('hidden');
            } finally {
                studyLoadingArea.classList.add('hidden'); // Hide spinner when done
            }
        }

        async function startLawQuiz(lawId, lawName) {
            currentLevel = 'leis'; // Set current level to laws
            selectedTopics = [{ id: lawId, name: lawName }];
            questionQuantity = 5; // Default questions for law quiz
            difficulty = 'intermediario'; // Default difficulty
            responseMode = 'multipla-escolha'; // Default response mode

            // Update display for simulado setup (optional, but good for consistency)
            displayNumQuestions.textContent = `${questionQuantity} Quest√µes`;
            displayDifficulty.textContent = 'Intermedi√°rio';
            displayResponseMode.textContent = 'M√∫ltipla Escolha (5 op√ß√µes)';

            // Directly start the quiz
            await startQuizOrSimulado();
        }


        async function generateQuestions() {
            // Define loadingArea and quizContent here
            const loadingArea = document.getElementById('loading-area');
            const quizContent = document.getElementById('quiz-content');

            loadingArea.classList.remove('hidden');
            quizContent.classList.add('hidden');
            loadingText.textContent = "Gerando Quest√µes...";

            const responseSchema = {
                type: "ARRAY",
                items: {
                    type: "OBJECT",
                    properties: {
                        "textContext": { "type": "STRING" },
                        "question": { "type": "STRING" },
                        "options": { "type": "ARRAY", "items": { "type": "STRING" } },
                        "correctAnswer": { "type": "STRING" }
                    },
                    required: ["question", "options", "correctAnswer"]
                }
            };
            
            let allGeneratedQuestions = [];
            try {
                for (const topic of selectedTopics) {
                    const numQuestionsForTopic = topic.quantity || Math.ceil(questionQuantity / selectedTopics.length);
                    let prompt = '';
                    let subjectName = "";

                    if (currentLevel === 'informatica') {
                        subjectName = "No√ß√µes de Inform√°tica";
                    } else if (currentLevel === 'leis') {
                        subjectName = "Legisla√ß√£o Educacional";
                    } else {
                        for (const cat of grammarData) {
                            if (cat.levels.includes(currentLevel) && cat.subCategories?.some(subCat => subCat.topics.some(t => t.id === topic.id))) {
                                subjectName = cat.category;
                                break;
                            }
                        }
                    }

                    // --- IN√çCIO DA MODIFICA√á√ÉO PARA O TIPO DE GABARITO ---
                    let promptQuestionFormat = '';
                    let promptOptionsFormat = '';
                    let promptCorrectAnswerFormat = '';

                    if (responseMode === 'multipla-escolha') {
                        promptQuestionFormat = 'um enunciado ("question")';
                        promptOptionsFormat = '5 op√ß√µes de resposta ("options")';
                        promptCorrectAnswerFormat = 'uma das 5 op√ß√µes para o campo "correctAnswer"';
                    } else if (responseMode === 'certo-errado') {
                        promptQuestionFormat = 'uma afirma√ß√£o para o campo "question" (que seja verdadeira ou falsa)';
                        promptOptionsFormat = 'o campo "options" deve conter estritamente apenas ["Certo", "Errado"]';
                        promptCorrectAnswerFormat = 'o campo "correctAnswer" deve ser estritamente "Certo" ou "Errado"';
                        // Adjust schema for Certo/Errado to expect only two options
                        responseSchema.items.properties.options = {
                            type: "ARRAY",
                            items: { "type": "STRING" },
                            minItems: 2,
                            maxItems: 2
                        };
                    }

                    prompt = `Gere ${numQuestionsForTopic} quest√µes sobre o t√≥pico de ${subjectName} "${topic.name}" para um simulado de n√≠vel ${difficulty}. As quest√µes devem ser elaboradas com o n√≠vel e estilo das bancas de concurso FCC, FGV e Cebraspe. Para cada quest√£o, forne√ßa ${promptQuestionFormat}, ${promptOptionsFormat}, e ${promptCorrectAnswerFormat}. Se relevante, inclua um texto de apoio ("textContext").`;
                    // --- FIM DA MODIFICA√á√ÉO PARA O TIPO DE GABARITO ---
                    
                    const parsedQuestions = await callGeminiAPI(prompt, true, responseSchema);
                    parsedQuestions.forEach(q => {
                        q.topicId = topic.id;
                        q.topicName = topic.name;
                    });
                    allGeneratedQuestions.push(...parsedQuestions);
                }
                return allGeneratedQuestions.sort(() => Math.random() - 0.5);
            } catch (error) {
                console.error('Error generating questions:', error); // Debugging log
                return [];
            } finally {
                loadingArea.classList.add('hidden');
                quizContent.classList.remove('hidden');
            }
        }

        function displayQuestion() {
            if (currentQuestionIndex >= quizQuestions.length) {
                endQuiz();
                return;
            }
            currentQuestionData = quizQuestions[currentQuestionIndex];
            // Usando textContent para maior seguran√ßa contra XSS
            questionText.textContent = currentQuestionData.question; 
            optionsContainer.innerHTML = '';
            showTextButton.classList.toggle('hidden', !currentQuestionData.textContext);

            const options = responseMode === 'certo-errado' ? ['Certo', 'Errado'] : currentQuestionData.options;
            options.forEach((optionText, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn bg-blue-50 hover:bg-blue-100 text-blue-800 font-medium py-3 px-4 rounded-lg text-left shadow-sm border border-blue-200';
                button.textContent = optionText; // textContent para seguran√ßa
                button.addEventListener('click', () => checkAnswer(button, currentQuestionData.correctAnswer));
                optionsContainer.appendChild(button);
            });

            questionCounter.textContent = `Quest√£o ${currentQuestionIndex + 1} de ${quizQuestions.length}`;
            nextQuestionButton.classList.add('hidden');
            appealQuestionButton.classList.add('hidden');
            updateProgressBar();
        }

        async function showExplanationForIncorrectAnswer(questionData, selectedText) {
            studyModalTitleText.textContent = `Explica√ß√£o: ${questionData.topicName}`; // Set title
            studyText.innerHTML = ''; // Clear previous content
            studyText.classList.add('hidden'); // Hide text content
            studyLoadingArea.classList.remove('hidden'); // Show spinner
            openModal(studyModal); // Open the modal immediately

            try {
                let subjectName = "";
                if (currentLevel === 'informatica') {
                    subjectName = "No√ß√µes de Inform√°tica";
                } else if (currentLevel === 'leis') {
                    subjectName = "Legisla√ß√£o Educacional";
                } else {
                    for (const cat of grammarData) {
                        if (cat.subCategories?.some(subCat => subCat.topics.some(t => t.id === questionData.topicId))) {
                            subjectName = cat.category;
                            break;
                        }
                    }
                }
                const prompt = `Explique detalhadamente por que a resposta correta para a quest√£o de ${subjectName} '${questionData.question}' √© '${questionData.correctAnswer}', e por que a resposta '${selectedText}' est√° incorreta. Para termos chave, use a tag HTML <highlight-term>termo</highlight-term>. Para sublinhar, use <underline-text>texto a sublinhar</underline-text>. Para destacar frases importantes, use <important-phrase>frase importante</important-phrase>.`;
                const explanationText = await callGeminiAPI(prompt);
                const styledHtml = applyStudyTextStyling(marked.parse(explanationText));
                studyText.innerHTML = styledHtml;
                studyText.classList.remove('hidden'); // Show text content
            } catch (error) {
                console.error(`Erro ao carregar explica√ß√£o para a quest√£o:`, error);
                studyText.textContent = 'N√£o foi poss√≠vel carregar a explica√ß√£o.';
                studyText.classList.remove('hidden'); // Show error message
            } finally {
                studyLoadingArea.classList.add('hidden'); // Hide spinner
            }
        }

        function checkAnswer(selectedButton, correctAnswer) {
            const isCorrect = selectedButton.textContent.trim() === correctAnswer.trim();
            document.querySelectorAll('#options-container .option-btn').forEach(btn => {
                btn.disabled = true;
                if (btn.textContent.trim() === correctAnswer.trim()) {
                    btn.classList.add('correct');
                } else if (btn === selectedButton) {
                    btn.classList.add('incorrect');
                }
            });

            if (isCorrect) {
                score++;
                scoreDisplay.textContent = score;
                performanceReport[currentQuestionData.topicId].correct++;
            } else {
                performanceReport[currentQuestionData.topicId].incorrect++;
                showExplanationForIncorrectAnswer(currentQuestionData, selectedButton.textContent);
            }

            nextQuestionButton.classList.remove('hidden');
            appealQuestionButton.classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            displayQuestion();
        }

        function updateProgressBar() {
            const progress = (currentQuestionIndex / quizQuestions.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        function endQuiz() {
            stopTimer();
            finalTimeDisplay.textContent = `Tempo total: ${formatTime(timeLeft)}`;
            finalTimeDisplay.classList.remove('hidden');
            showPerformanceReport();
            finalScoreDisplay.textContent = `${score}/${quizQuestions.length}`;
            finalTopicDisplay.textContent = "Simulado";
            showScreen(finalScreen);
        }

        function startTimer() {
            let seconds = 0;
            timerInterval = setInterval(() => {
                seconds++;
                timeLeft = seconds;
                timerDisplay.textContent = formatTime(seconds);
            }, 1000);
            timerDisplayContainer.classList.remove('hidden');
        }

        function stopTimer() {
            clearInterval(timerInterval);
            timerDisplayContainer.classList.add('hidden');
        }

        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        async function openAppealModal() {
            appealTextArea.value = '';
            appealResponseText.textContent = '';
            appealResponseContainer.classList.add('hidden');
            submitAppealButton.disabled = false;
            openModal(appealModal);
        }

        async function submitAppeal() {
            const userAppeal = appealTextArea.value.trim();
            if (!userAppeal) return;
            submitAppealButton.disabled = true;
            appealResponseContainer.classList.remove('hidden');
            appealResponseText.innerHTML = '<div class="spinner"></div>'; // Show spinner immediately

            try {
                const prompt = `Avalie o seguinte recurso de quest√£o. A quest√£o era: "${currentQuestionData.question}". A resposta correta era: "${currentQuestionData.correctAnswer}". O usu√°rio argumentou: "${userAppeal}". O recurso √© v√°lido? Justifique.`;
                const appealResponse = await callGeminiAPI(prompt);
                appealResponseText.textContent = appealResponse;
            } catch (error) {
                console.error(`Erro ao submeter recurso:`, error);
                appealResponseText.textContent = 'Erro ao avaliar o recurso.';
            }
        }

        function openQuestionDistributionModal() {
            expectedTotalQuestionsSpan.textContent = questionQuantity;
            distributionTotalDisplay.textContent = '0';
            questionDistributionContainer.innerHTML = '';
            selectedTopics.forEach(topic => {
                const topicDiv = document.createElement('div');
                topicDiv.className = 'flex items-center justify-between bg-slate-50 p-3 rounded-lg border border-slate-200';
                topicDiv.innerHTML = `
                    <span class="text-slate-700 font-medium">${topic.name}:</span>
                    <input type="number" data-topic-id="${topic.id}" class="topic-distribution-input w-20 p-2 border border-slate-300 rounded-lg text-center" value="0" min="0">
                `;
                questionDistributionContainer.appendChild(topicDiv);
            });
            questionDistributionContainer.querySelectorAll('.topic-distribution-input').forEach(input => {
                input.addEventListener('input', updateDistributionTotal);
            });
            openModal(questionDistributionModal);
        }

        function updateDistributionTotal() {
            let currentTotal = Array.from(document.querySelectorAll('.topic-distribution-input')).reduce((sum, input) => sum + (parseInt(input.value) || 0), 0);
            distributionTotalDisplay.textContent = currentTotal;
            const isTotalCorrect = currentTotal === questionQuantity;
            confirmDistributionBtn.disabled = !isTotalCorrect;
            confirmDistributionBtn.classList.toggle('opacity-50', !isTotalCorrect);
            confirmDistributionBtn.classList.toggle('cursor-not-allowed', !isTotalCorrect);
            distributionErrorMessage.classList.toggle('hidden', isTotalCorrect);
        }

        function randomizeDistribution() {
            let total = questionQuantity;
            const inputs = Array.from(document.querySelectorAll('.topic-distribution-input'));
            const numTopics = inputs.length;
            if (numTopics === 0) return;
            const base = Math.floor(total / numTopics);
            let remainder = total % numTopics;
            inputs.forEach((input, index) => {
                input.value = base + (index < remainder ? 1 : 0);
            });
            updateDistributionTotal();
        }

        async function confirmDistributionAndStartSimulado() {
            selectedTopics.forEach(topic => {
                const input = questionDistributionContainer.querySelector(`input[data-topic-id="${topic.id}"]`);
                topic.quantity = parseInt(input.value) || 0;
            });
            closeModal(questionDistributionModal); // FIX: Changed from questionDistributionContainer
            await startQuizOrSimulado();
        }

        function showPerformanceReport() {
            performanceReportContent.innerHTML = '';
            Object.entries(performanceReport).forEach(([topicId, results]) => {
                const topic = selectedTopics.find(t => t.id === topicId) || { name: 'Desconhecido' };
                const p = document.createElement('p');
                p.innerHTML = `<strong>${topic.name}:</strong> Acertos: ${results.correct}, Erros: ${results.incorrect}`;
                performanceReportContent.appendChild(p);
            });
            openModal(performanceReportModal);
        }

        function openTextModal(text) {
            textModalContent.innerHTML = text.replace(/\n/g, '<br>');
            openModal(textModal);
        }

        async function correctEssay() {
            const fullEssay = [essayTitleInput.value, introInput.value, devInput.value, concInput.value].join('\n\n').trim();
            if (!fullEssay) return;
            correctionLoadingArea.classList.remove('hidden');
            correctEssayBtn.disabled = true;
            try {
                const prompt = `Avalie a seguinte reda√ß√£o do tipo "${essayType}", focando em gram√°tica, coes√£o, coer√™ncia e argumenta√ß√£o. Forne√ßa feedback detalhado e uma nota de 0 a 100. Formate com Markdown. Reda√ß√£o:\n\n${fullEssay}`;
                const feedbackMarkdown = await callGeminiAPI(prompt);
                essayFeedback.innerHTML = marked.parse(feedbackMarkdown);
                postCorrectionActions.classList.remove('hidden');
            } catch (error) {
                console.error(`Erro ao corrigir reda√ß√£o:`, error);
                essayFeedback.innerHTML = '<p class="text-red-500">Erro ao corrigir a reda√ß√£o.</p>';
            } finally {
                correctionLoadingArea.classList.add('hidden');
                correctEssayBtn.disabled = false;
            }
        }

        function redoEssay(keepTheme) {
            [essayTitleInput, introInput, devInput, concInput].forEach(input => input.value = '');
            essayFeedback.innerHTML = '<p class="text-slate-500 italic">Seu feedback aparecer√° aqui.</p>';
            postCorrectionActions.classList.add('hidden');
            if (!keepTheme) {
                generatedEssayTheme = '';
                generatedThemeText.textContent = ''; // Clear the displayed theme text
                themeDisplay.classList.add('hidden'); // Hide the theme display area
            }
        }

        async function downloadEssayPdf() {
            pdfLoadingArea.classList.remove('hidden');
            downloadEssayPdfBtn.disabled = true;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const tempDiv = document.createElement('div');
            tempDiv.style.width = '180mm';
            tempDiv.innerHTML = `<h1>${essayTitleInput.value}</h1><h2>Tema: ${generatedEssayTheme}</h2><div>${introInput.value}</div><div>${devInput.value}</div><div>${concInput.value}</div><hr><h2>Feedback</h2><div>${essayFeedback.innerHTML}</div>`;
            document.body.appendChild(tempDiv);
            try {
                await doc.html(tempDiv, {
                    callback: function (doc) {
                        doc.save('redacao_feedback.pdf');
                    },
                    x: 15,
                    y: 15,
                    width: 180,
                    windowWidth: 650
                });
            } catch (error) {
                console.error("Erro ao gerar PDF:", error);
            } finally {
                document.body.removeChild(tempDiv);
                pdfLoadingArea.classList.add('hidden');
                downloadEssayPdfBtn.disabled = false;
            }
        }
        
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        function initializeAppUI() {
            showScreen(homeScreen);
            currentLevel = null;
            selectedTopics = [];
            questionQuantity = 10;
            difficulty = null;
            responseMode = null;
            isSimulado = true;
            levelSelectButtons.forEach(btn => btn.classList.remove('selected', 'ring-4', 'ring-blue-400'));
            enterAppButton.disabled = true;
            enterAppButton.classList.add('opacity-50', 'cursor-not-allowed');
            displayNumQuestions.textContent = '---';
            displayDifficulty.textContent = '---';
            displayResponseMode.textContent = '---';
            updateStartButtonState(startSimuladoButton);
            redoEssay(false); // reseta e oculta campos da reda√ß√£o, mas n√£o abre o modal de tema
            themeDisplay.classList.add('hidden');
            topicSearchInput.value = ''; // Clear search input
        }

        async function startQuizOrSimulado() {
            if (selectedTopics.length === 0) return;
            performanceReport = {};
            selectedTopics.forEach(topic => {
                performanceReport[topic.id] = { correct: 0, incorrect: 0 };
            });
            showScreen(quizScreen);
            quizQuestions = [];
            currentQuestionIndex = 0;
            score = 0;
            scoreDisplay.textContent = score;
            let subject = "Simulado";
            if (currentLevel === 'informatica') {
                subject = "No√ß√µes de Inform√°tica";
            } else {
                subject = grammarData.find(cat => cat.levels.includes(currentLevel))?.category || "Simulado";
            }
            quizTopicTitle.textContent = `${subject} - N√≠vel: ${difficulty || 'N/A'}`;
            startTimer();
            quizQuestions = await generateQuestions();
            if (quizQuestions.length > 0) {
                displayQuestion();
            } else {
                questionText.textContent = "N√£o foi poss√≠vel carregar as quest√µes. Verifique o console para mais detalhes."; // Updated error message
            }
        }

        function populateDisciplinaSelect() {
            selectDisciplinaTema.innerHTML = '<option value="">Selecione...</option>';
            [
                "Letras ‚Äì Portugu√™s",
                "Letras ‚Äì Ingl√™s",
                "Letras ‚Äì Espanhol",
                "Letras ‚Äì Franc√™s",
                "Artes Visuais",
                "Teatro",
                "Dan√ßa",
                "M√∫sica",
                "Educa√ß√£o Art√≠stica",
                "Educa√ß√£o F√≠sica",
                "Ci√™ncias Biol√≥gicas (Biologia)",
                "F√≠sica",
                "Qu√≠mica",
                "Ci√™ncias Naturais",
                "Matem√°tica",
                "Geografia",
                "Hist√≥ria",
                "Filosofia",
                "Sociologia",
                "Pedagogia",
                "Ci√™ncias Sociais",
                "Educa√ß√£o do Campo",
                "Educa√ß√£o Ind√≠gena",
                "Educa√ß√£o Quilombola",
                "Educa√ß√£o Intercultural",
                "Educa√ß√£o Especial",
                "Ci√™ncias Ambientais",
                "Inform√°tica na Educa√ß√£o",
                "Libras (L√≠ngua Brasileira de Sinais)",
                "Tecnologias Educacionais"
            ].forEach(d => {
                selectDisciplinaTema.innerHTML += `<option value="${d}">${d}</option>`;
            });
        }

        const disciplineCategoryMap = { "Portugu√™s": "L√≠ngua Portuguesa", "Pedagogia": "Conhecimentos Pedag√≥gicos", "Direito": "Direito", "Inform√°tica": "No√ß√µes de Inform√°tica" };

        async function generateEssayTheme(type, specificTheme = '') {
            temaLoadingArea.classList.remove('hidden');
            confirmGerarTemaBtn.disabled = true;
            confirmGerarTemaBtn.classList.add('opacity-50', 'cursor-not-allowed'); // Ensure disabled style is applied
            let prompt;
            if (type === 'current') {
                prompt = `Considerando uma vasta gama de temas atuais e relevantes para concursos p√∫blicos, gere **apenas um** tema de reda√ß√£o conciso e direto sobre '${specificTheme}', sem introdu√ß√µes, explica√ß√µes ou formata√ß√£o adicional, como aspas ou marcadores de lista. O tema deve ser uma frase que possa servir como t√≠tulo ou proposta de reda√ß√£o. Por exemplo: 'A import√¢ncia da educa√ß√£o na sociedade contempor√¢nea'.`;
            } else if (type === 'discipline' && specificTheme) {
                prompt = `Considerando uma vasta gama de temas de reda√ß√£o para concursos p√∫blicos relacionados √† disciplina de '${specificTheme}', gere **apenas um** tema conciso e direto, sem introdu√ß√µes, explica√ß√µes ou formata√ß√£o adicional, como aspas ou marcadores de lista. O tema deve ser uma frase que possa servir como t√≠tulo ou proposta de reda√ß√£o. Por exemplo: 'O papel da matem√°tica no desenvolvimento do pensamento cr√≠tico'.`;
            } else return;

            try {
                const theme = await callGeminiAPI(prompt);
                // Clean up the theme string from any unwanted characters or extra text
                generatedEssayTheme = theme.replace(/^(Tema:\s*|##\s*\*\*|\*\*|["'])/gi, '', '').replace(/["']$/g, '').trim();
                generatedThemeText.textContent = generatedEssayTheme;
                themeDisplay.classList.remove('hidden');
                closeModal(modalGerarTema);
                // Enable essay inputs and correction button after theme generation
                [essayTitleInput, introInput, devInput, concInput].forEach(el => el.disabled = false);
                correctEssayBtn.disabled = false;
                helpButtons.forEach(btn => btn.classList.remove('disabled'));
            } catch (error) {
                console.error(`Erro ao gerar tema da reda√ß√£o:`, error);
                generatedThemeText.textContent = 'Erro ao gerar tema. Tente novamente.';
                themeDisplay.classList.remove('hidden');
            } finally {
                temaLoadingArea.classList.add('hidden');
                // The button state will be handled by the change listeners on input/select
            }
        }

        async function openHelpTipsModal(section) {
            currentHelpSection = section;
            helpTipsSectionName.textContent = section.charAt(0).toUpperCase() + section.slice(1);
            currentTips = [];
            currentTipIndex = 0;
            helpTipsContent.innerHTML = ''; // Clear previous content
            helpTipsContent.classList.add('hidden'); // Hide text content
            helpTipsLoadingArea.classList.remove('hidden'); // Show spinner
            openModal(helpTipsModal);
            await generateTipsForSection(section, 'initial');
        }

        async function generateTipsForSection(section, type) {
            helpTipsLoadingArea.classList.remove('hidden');
            generateMoreTipsBtn.disabled = true;
            const context = `Considerando a reda√ß√£o tipo "${essayType}" sobre "${generatedEssayTheme}", `;
            const prompt = `${context} gere ${type === 'initial' ? 5 : 3} dicas pr√°ticas para a ${section} da reda√ß√£o. Para cada dica, inclua o tipo (vocabulario, tecnica, geral, exemplo) e o conte√∫do. Para dicas de vocabul√°rio, forne√ßa palavras cultas e express√µes formais relevantes para a se√ß√£o, com um breve contexto de uso. Para t√©cnicas, descreva m√©todos de escrita. Para dicas gerais, ofere√ßa conselhos amplos. Formate como array JSON de objetos, cada um com 'type' (string) e 'content' (string).`;
            
            const schema = {
                type: "ARRAY",
                items: {
                    type: "OBJECT",
                    properties: {
                        "type": { "type": "STRING", "enum": ["vocabulario", "tecnica", "geral", "exemplo"] },
                        "content": { "type": "STRING" }
                    },
                    required: ["type", "content"]
                }
            };

            try {
                const newTips = await callGeminiAPI(prompt, true, schema);
                currentTips.push(...newTips);
                if (type === 'initial') currentTipIndex = 0;
                displayCurrentTip();
                helpTipsContent.classList.remove('hidden'); // Show text content
            }
            catch (error) {
                console.error(`Erro ao gerar dicas para a se√ß√£o ${section}:`, error);
                helpTipsContent.textContent = 'Erro ao gerar dicas.';
                helpTipsContent.classList.remove('hidden'); // Show error message
            } finally {
                helpTipsLoadingArea.classList.add('hidden'); // Hide spinner
                generateMoreTipsBtn.disabled = false;
            }
        }

        function displayCurrentTip() {
            if (currentTips.length > 0) {
                const currentTip = currentTips[currentTipIndex];
                let contentHtml = '';
                if (currentTip.type === 'vocabulario') {
                    contentHtml = `<p class="font-semibold text-indigo-700">Vocabul√°rio e Express√µes:</p><p>${currentTip.content}</p>`;
                } else if (currentTip.type === 'tecnica') {
                    contentHtml = `<p class="font-semibold text-emerald-700">T√©cnica de Reda√ß√£o:</p><p>${currentTip.content}</p>`;
                } else if (currentTip.type === 'geral') {
                    contentHtml = `<p class="font-semibold text-blue-700">Dica Geral:</p><p>${currentTip.content}</p>`;
                } else if (currentTip.type === 'exemplo') {
                    contentHtml = `<p class="font-semibold text-purple-700">Exemplo:</p><p>${currentTip.content}</p>`;
                } else {
                    contentHtml = `<p>${currentTip.content}</p>`; // Fallback
                }
                // Usando textContent para maior seguran√ßa contra XSS, ou sanitizar explicitamente
                helpTipsContent.textContent = currentTip.content; // Alterado para textContent
                tipCounter.textContent = `${currentTipIndex + 1} de ${currentTips.length}`;
                prevTipBtn.disabled = currentTipIndex === 0;
                nextTipBtn.disabled = currentTipIndex === currentTips.length - 1;
            } else {
                helpTipsContent.textContent = "Nenhuma dica dispon√≠vel.";
                tipCounter.textContent = "0 de 0";
                prevTipBtn.disabled = nextTipBtn.disabled = true;
            }
        }


        levelSelectButtons.forEach(button => button.addEventListener('click', () => {
            currentLevel = button.dataset.level;
            levelSelectButtons.forEach(btn => btn.classList.remove('selected', 'ring-4', 'ring-blue-400'));
            button.classList.add('selected', 'ring-4', 'ring-blue-400');
            enterAppButton.disabled = false;
            enterAppButton.classList.remove('opacity-50', 'cursor-not-allowed');
        }));

        enterAppButton.addEventListener('click', () => {
            if (currentLevel === 'redacao-correcao') {
                openModal(modalConfigRedacao);
            } else if (currentLevel === 'leis') {
                renderLawsList();
                showScreen(lawsScreen);
            } else {
                renderTopics(); // Render topics initially without a search term
                showScreen(simuladoSetupScreen);
            }
        });

        confirmConfigRedacaoBtn.addEventListener('click', () => {
            essayType = selectTipoRedacao.value;
            essayLineQuantity = parseInt(inputQuantidadeLinhas.value);
            closeModal(modalConfigRedacao);
            showScreen(essayCorrectionScreen);
            // Disable essay inputs and correction button until a theme is generated
            [essayTitleInput, introInput, devInput, concInput].forEach(el => el.disabled = true);
            correctEssayBtn.disabled = true;
            helpButtons.forEach(btn => btn.classList.add('disabled'));
        });

        [btnNumQuestions, btnDifficulty, btnResponseMode].forEach(btn => {
            btn.addEventListener('click', () => {
                const modalId = btn.id.replace('btn-', '') + '-modal';
                openModal(document.getElementById(modalId));
            });
        });
        
        // Updated logic for confirmNumQuestionsBtn
        confirmNumQuestionsBtn.addEventListener('click', () => {
            questionQuantity = parseInt(modalQuestionQuantityInput.value);
            displayNumQuestions.textContent = `${questionQuantity} Quest√µes`;
            closeModal(numQuestionsModal);
            updateStartButtonState(startSimuladoButton);
        });

        // Updated logic for confirmDifficultyBtn
        confirmDifficultyBtn.addEventListener('click', () => {
            const selectedRadio = document.querySelector('input[name="modalDifficulty"]:checked');
            if (selectedRadio) {
                difficulty = selectedRadio.value;
                displayDifficulty.textContent = selectedRadio.labels[0].textContent;

                // Remove 'selected' class from all labels first
                document.querySelectorAll('.difficulty-label').forEach(label => {
                    label.classList.remove('selected');
                });

                // Add 'selected' class to the label of the chosen radio button
                const correspondingLabel = document.querySelector(`label[for="${selectedRadio.id}"]`);
                if (correspondingLabel) {
                    correspondingLabel.classList.add('selected');
                }

                closeModal(difficultyModal);
                updateStartButtonState(startSimuladoButton);
            }
        });

        // Event listener for difficulty radio buttons to apply 'selected' class immediately on change
        modalDifficultyRadios.forEach(radio => {
            radio.addEventListener('change', (event) => {
                document.querySelectorAll('.difficulty-label').forEach(label => {
                    label.classList.remove('selected');
                });
                if (event.target.checked) {
                    const correspondingLabel = document.querySelector(`label[for="${event.target.id}"]`);
                    if (correspondingLabel) {
                        correspondingLabel.classList.add('selected');
                    }
                }
            });
        });

        // Updated logic for confirmResponseModeBtn
        confirmResponseModeBtn.addEventListener('click', () => {
            const selectedRadio = document.querySelector('input[name="modalResponseMode"]:checked');
            if (selectedRadio) {
                responseMode = selectedRadio.value;
                displayResponseMode.textContent = selectedRadio.labels[0].textContent;

                // Remove 'selected' class from all labels first
                document.querySelectorAll('.response-mode-label').forEach(label => {
                    label.classList.remove('selected');
                });

                // Add 'selected' class to the label of the chosen radio button
                const correspondingLabel = document.querySelector(`label[for="${selectedRadio.id}"]`);
                if (correspondingLabel) {
                    correspondingLabel.classList.add('selected');
                }

                closeModal(responseModeModal);
                updateStartButtonState(startSimuladoButton);
            }
        });

        // Event listener for response mode radio buttons to apply 'selected' class immediately on change
        modalResponseModeRadios.forEach(radio => {
            radio.addEventListener('change', (event) => {
                document.querySelectorAll('.response-mode-label').forEach(label => {
                    label.classList.remove('selected');
                });
                if (event.target.checked) {
                    const correspondingLabel = document.querySelector(`label[for="${event.target.id}"]`);
                    if (correspondingLabel) {
                        correspondingLabel.classList.add('selected');
                    }
                }
            });
        });


        startSimuladoButton.addEventListener('click', () => {
            if (selectedTopics.length > 1) {
                openQuestionDistributionModal();
            } else {
                selectedTopics.forEach(t => t.quantity = questionQuantity);
                startQuizOrSimulado();
            }
        });
        
        document.querySelectorAll('.back-to-home').forEach(btn => btn.addEventListener('click', initializeAppUI));
        nextQuestionButton.addEventListener('click', nextQuestion);
        backToMenuButton.addEventListener('click', () => showScreen(simuladoSetupScreen));
        restartQuizButton.addEventListener('click', startQuizOrSimulado);
        backToMenuFinalButton.addEventListener('click', () => showScreen(simuladoSetupScreen));
        appealQuestionButton.addEventListener('click', openAppealModal);
        closeStudyModalButton.addEventListener('click', () => closeModal(studyModal));
        submitAppealButton.addEventListener('click', submitAppeal);
        cancelNumQuestionsBtn.addEventListener('click', () => closeModal(numQuestionsModal));
        cancelDifficultyBtn.addEventListener('click', () => closeModal(difficultyModal));
        cancelResponseModeBtn.addEventListener('click', () => closeModal(responseModeModal));
        closeAppealModalButton.addEventListener('click', () => closeModal(appealModal));
        randomizeDistributionBtn.addEventListener('click', randomizeDistribution);
        confirmDistributionBtn.addEventListener('click', confirmDistributionAndStartSimulado);
        cancelDistributionBtn.addEventListener('click', () => closeModal(questionDistributionModal));
        closeReportModalBtn.addEventListener('click', () => closeModal(performanceReportModal));
        showTextButton.addEventListener('click', () => openTextModal(currentQuestionData.textContext));
        closeTextModalButton.addEventListener('click', () => closeModal(textModal));
        correctEssayBtn.addEventListener('click', correctEssay);
        redoSameThemeBtn.addEventListener('click', () => redoEssay(true));
        redoNewThemeBtn.addEventListener('click', () => redoEssay(false));
        downloadEssayPdfBtn.addEventListener('click', downloadEssayPdf);
        generateThemeBtn.addEventListener('click', () => {
            populateDisciplinaSelect();
            openModal(modalGerarTema);
            // Reset state of theme generation buttons and input
            currentThemeInput.value = '';
            disciplinaSelectContainer.classList.add('hidden');
            currentThemeInputContainer.classList.add('hidden');
            confirmGerarTemaBtn.disabled = true;
            confirmGerarTemaBtn.classList.add('opacity-50', 'cursor-not-allowed');
        });
        btnTemasAtuais.addEventListener('click', () => {
            disciplinaSelectContainer.classList.add('hidden');
            currentThemeInputContainer.classList.remove('hidden');
            // Only enable if currentThemeInput has value
            confirmGerarTemaBtn.disabled = !currentThemeInput.value.trim();
            confirmGerarTemaBtn.classList.toggle('opacity-50', !currentThemeInput.value.trim());
            confirmGerarTemaBtn.classList.toggle('cursor-not-allowed', !currentThemeInput.value.trim());
            confirmGerarTemaBtn.dataset.themeType = 'current';
        });
        btnTemasDisciplina.addEventListener('click', () => {
            currentThemeInputContainer.classList.add('hidden');
            disciplinaSelectContainer.classList.remove('hidden');
            // Set theme type for confirmation
            confirmGerarTemaBtn.dataset.themeType = 'discipline';
            // Check initial state of selectDisciplinaTema to enable/disable button
            confirmGerarTemaBtn.disabled = !selectDisciplinaTema.value;
            confirmGerarTemaBtn.classList.toggle('opacity-50', !selectDisciplinaTema.value);
            confirmGerarTemaBtn.classList.toggle('cursor-not-allowed', !selectDisciplinaTema.value);
        });
        selectDisciplinaTema.addEventListener('change', () => {
            // Enable/disable button based on selection
            confirmGerarTemaBtn.disabled = !selectDisciplinaTema.value;
            confirmGerarTemaBtn.classList.toggle('opacity-50', !selectDisciplinaTema.value);
            confirmGerarTemaBtn.classList.toggle('cursor-not-allowed', !selectDisciplinaTema.value);
        });
        currentThemeInput.addEventListener('input', () => {
            confirmGerarTemaBtn.disabled = !currentThemeInput.value.trim();
            confirmGerarTemaBtn.classList.toggle('opacity-50', !currentThemeInput.value.trim());
            confirmGerarTemaBtn.classList.toggle('cursor-not-allowed', !currentThemeInput.value.trim());
        });

        confirmGerarTemaBtn.addEventListener('click', () => {
            const type = confirmGerarTemaBtn.dataset.themeType;
            const value = type === 'current' ? currentThemeInput.value : selectDisciplinaTema.value;
            generateEssayTheme(type, value);
        });
        cancelGerarTemaBtn.addEventListener('click', () => closeModal(modalGerarTema));
        helpButtons.forEach(btn => btn.addEventListener('click', e => openHelpTipsModal(e.currentTarget.dataset.section)));
        prevTipBtn.addEventListener('click', () => { if (currentTipIndex > 0) { currentTipIndex--; displayCurrentTip(); } });
        nextTipBtn.addEventListener('click', () => { if (currentTipIndex < currentTips.length - 1) { currentTipIndex++; displayCurrentTip(); } });
        generateMoreTipsBtn.addEventListener('click', () => generateTipsForSection(currentHelpSection, 'more'));
        closeHelpTipsModalBtn.addEventListener('click', () => closeModal(helpTipsModal));
        
        // New: Event listener for topic search input
        topicSearchInput.addEventListener('input', (event) => {
            renderTopics(event.target.value);
        });

        const markedScript = document.createElement('script');
        markedScript.src = 'https://cdn.jsdelivr.net/npm/marked/marked.min.js';
        document.head.appendChild(markedScript);

        const jspdfScript = document.createElement('script');
        jspdfScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
        document.head.appendChild(jspdfScript);
        
        const html2canvasScript = document.createElement('script');
        html2canvasScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
        document.head.appendChild(html2canvasScript);

        window.onload = initializeAppUI;
    </script>
</body>
</html>
